{"version":3,"sources":["../../../src/operations/system/FileManagerInstallationPlugin.ts"],"names":["FileManagerInstallationPlugin","InstallationPlugin","beforeInstall","context","elasticsearch","esIndex","configurations","es","body","exists","indices","create","settings","analysis","analyzer","lowercase_analyzer","type","filter","tokenizer","mappings","properties","property","fields","keyword","ignore_above","rawValues","enabled"],"mappings":";;;;;;;;;;;AAAA;;AACA;;;;;;AAEO,MAAMA,6BAAN,SAA4CC,sCAA5C,CAA+D;AAAA;AAAA;AAAA,gDACpD,+BADoD;AAAA;;AAGxC,QAAbC,aAAa,CAAC;AAAEC,IAAAA;AAAF,GAAD,EAA6B;AACnD,UAAM;AAAEC,MAAAA;AAAF,QAAoBD,OAA1B;;AACA,UAAME,OAAO,GAAGC,wBAAeC,EAAf,CAAkBJ,OAAlB,CAAhB;;AACA,UAAM;AAAEK,MAAAA,IAAI,EAAEC;AAAR,QAAmB,MAAML,aAAa,CAACM,OAAd,CAAsBD,MAAtB,CAA6BJ,OAA7B,CAA/B;;AACA,QAAII,MAAJ,EAAY;AACR;AACH;;AACD,UAAML,aAAa,CAACM,OAAd,CAAsBC,MAAtB,iCACCN,OADD;AAEFG,MAAAA,IAAI,EAAE;AACF;AACAI,QAAAA,QAAQ,EAAE;AACNC,UAAAA,QAAQ,EAAE;AACNC,YAAAA,QAAQ,EAAE;AACNC,cAAAA,kBAAkB,EAAE;AAChBC,gBAAAA,IAAI,EAAE,QADU;AAEhBC,gBAAAA,MAAM,EAAE,CAAC,WAAD,EAAc,MAAd,CAFQ;AAGhBC,gBAAAA,SAAS,EAAE;AAHK;AADd;AADJ;AADJ,SAFR;AAaFC,QAAAA,QAAQ,EAAE;AACNC,UAAAA,UAAU,EAAE;AACRC,YAAAA,QAAQ,EAAE;AACNL,cAAAA,IAAI,EAAE,MADA;AAENM,cAAAA,MAAM,EAAE;AACJC,gBAAAA,OAAO,EAAE;AACLP,kBAAAA,IAAI,EAAE,SADD;AAELQ,kBAAAA,YAAY,EAAE;AAFT;AADL,eAFF;AAQNV,cAAAA,QAAQ,EAAE;AARJ,aADF;AAWRW,YAAAA,SAAS,EAAE;AACPT,cAAAA,IAAI,EAAE,QADC;AAEPU,cAAAA,OAAO,EAAE;AAFF;AAXH;AADN;AAbR;AAFJ,OAAN;AAmCH;;AA7CiE","sourcesContent":["import { InstallationPlugin } from \"@webiny/api-file-manager/plugins/definitions/InstallationPlugin\";\nimport configurations from \"~/operations/configurations\";\n\nexport class FileManagerInstallationPlugin extends InstallationPlugin {\n    public name = \"fm.system.ddb-es-installation\";\n\n    public async beforeInstall({ context }): Promise<void> {\n        const { elasticsearch } = context;\n        const esIndex = configurations.es(context);\n        const { body: exists } = await elasticsearch.indices.exists(esIndex);\n        if (exists) {\n            return;\n        }\n        await elasticsearch.indices.create({\n            ...esIndex,\n            body: {\n                // need this part for sorting to work on text fields\n                settings: {\n                    analysis: {\n                        analyzer: {\n                            lowercase_analyzer: {\n                                type: \"custom\",\n                                filter: [\"lowercase\", \"trim\"],\n                                tokenizer: \"keyword\"\n                            }\n                        }\n                    }\n                },\n                mappings: {\n                    properties: {\n                        property: {\n                            type: \"text\",\n                            fields: {\n                                keyword: {\n                                    type: \"keyword\",\n                                    ignore_above: 256\n                                }\n                            },\n                            analyzer: \"lowercase_analyzer\"\n                        },\n                        rawValues: {\n                            type: \"object\",\n                            enabled: false\n                        }\n                    }\n                }\n            }\n        });\n    }\n}\n"],"file":"FileManagerInstallationPlugin.js"}