{"version":3,"sources":["../src/UIElement.ts"],"names":["pWaitFor","Plugin","plugins","UILayout","UIView","defaultShouldRender","UIElement","id","config","Map","Set","_id","_config","_layout","elementId","getElement","tags","_tags","shouldRender","_shouldRender","push","applyPlugins","getGrid","depth","parent","getParent","isGridEnabled","elementClass","type","prototype","constructor","name","elPlugins","byType","filter","plugin","canHandle","forEach","apply","renderer","_renderers","cb","layout","_parent","tag","elements","Array","from","_elements","values","element","children","getChildren","child","getDescendentsByTag","el","hasTag","getDescendentsByType","add","has","delete","setParent","insertElementAtTheEnd","set","flag","setGrid","ownElement","get","descendant","targetElement","remove","addElement","insertElementAfter","insertElementBefore","insertElementAbove","insertElementBelow","insertElementAtTheBeginning","addTag","removeElement","getView","undefined","interval","props","layoutRenderer","render","hasParentGrid","renderers","pl","canRender","next","length","pop","moveAfter","lookFor","UIElementPlugin","_elementClass","_apply"],"mappings":";;;;;;;;;;AACA,OAAOA,QAAP,MAAqB,YAArB;AACA,SAASC,MAAT,EAAiBC,OAAjB,QAAgC,iBAAhC;AACA,SAASC,QAAT;AACA,SAASC,MAAT;;AAcA,SAASC,mBAAT,GAA+B;AAC3B,SAAO,IAAP;AACH;;AAED,WAAaC,SAAb;AAUI,qBAAYC,EAAZ,EAAwBC,MAAxB,EAA0C;AAAA;;AAAA;;AAAA,uCATpB,IAAIC,GAAJ,EASoB;;AAAA;;AAAA;;AAAA,mCAN1B,IAAIC,GAAJ,EAM0B;;AAAA;;AAAA;;AAAA,wCAHF,EAGE;;AAAA,2CAFF,CAACL,mBAAD,CAEE;;AACtC,SAAKM,GAAL,GAAWJ,EAAX;AACA,SAAKK,OAAL,GAAeJ,MAAM,IAAK,EAA1B;AACA,SAAKK,OAAL,GAAe,IAAIV,QAAJ,CAAa,UAAAW,SAAS;AAAA,aAAI,KAAI,CAACC,UAAL,CAAgBD,SAAhB,CAAJ;AAAA,KAAtB,CAAf;;AAEA,QAAI,CAACN,MAAL,EAAa;AACT;AACH;;AAED,QAAIA,MAAM,CAACQ,IAAX,EAAiB;AACb,WAAKC,KAAL,GAAa,IAAIP,GAAJ,CAAQF,MAAM,CAACQ,IAAf,CAAb;AACH;;AAED,QAAIR,MAAM,CAACU,YAAX,EAAyB;AACrB,WAAKC,aAAL,CAAmBC,IAAnB,CAAwBZ,MAAM,CAACU,YAA/B;AACH;;AAED,SAAKG,YAAL,CAAkBf,SAAlB;AACH;;AA5BL;AAAA;AAAA,SA8BI,eAAS;AACL,aAAO,KAAKK,GAAZ;AACH;AAhCL;AAAA;AAAA,WAkCI,yBAAgB;AACZ,aAAO,KAAKE,OAAL,CAAaS,OAAb,EAAP;AACH;AApCL;AAAA;AAAA,SAsCI,eAAsB;AAClB,aAAO,KAAKV,OAAZ;AACH;AAxCL;AAAA;AAAA,SA0CI,eAAY;AACR,UAAIW,KAAK,GAAG,CAAZ;AAEA,UAAIC,MAAM,GAAG,KAAKC,SAAL,EAAb;;AACA,aAAOD,MAAM,IAAI,EAAEA,MAAM,YAAYpB,MAApB,CAAjB,EAA8C;AAC1CmB,QAAAA,KAAK;AACLC,QAAAA,MAAM,GAAGA,MAAM,CAACC,SAAP,EAAT;AACH;;AAED,aAAOF,KAAP;AACH;AApDL;AAAA;AAAA,SAsDI,eAAoB;AAChB,UAAIC,MAAM,GAAG,KAAKC,SAAL,EAAb;;AACA,aAAOD,MAAM,IAAI,EAAEA,MAAM,YAAYpB,MAApB,CAAjB,EAA8C;AAC1C,YAAIoB,MAAM,CAACE,aAAP,EAAJ,EAA4B;AACxB,iBAAO,IAAP;AACH;;AACDF,QAAAA,MAAM,GAAGA,MAAM,CAACC,SAAP,EAAT;AACH;;AAED,aAAO,KAAP;AACH;AAhEL;AAAA;AAAA,WAkEI,sBAAaE,YAAb,EAA6C;AAAA;;AACzC,UAAMC,IAAI,6BAAsBD,YAAY,CAACE,SAAb,CAAuBC,WAAvB,CAAmCC,IAAzD,CAAV;AACA,UAAMC,SAAS,GAAG9B,OAAO,CAAC+B,MAAR,CAAqCL,IAArC,CAAlB;AACAI,MAAAA,SAAS,CACJE,MADL,CACY,UAAAC,MAAM;AAAA,eAAIA,MAAM,CAACC,SAAP,CAAiBT,YAAjB,CAAJ;AAAA,OADlB,EAEKU,OAFL,CAEa,UAAAF,MAAM;AAAA,eAAIA,MAAM,CAACG,KAAP,CAAa,MAAb,CAAJ;AAAA,OAFnB;AAGH;AAxEL;AAAA;AAAA,WA0EI,qBAAYC,QAAZ,EAAuC;AACnC,WAAKC,UAAL,CAAgBpB,IAAhB,CAAqBmB,QAArB;AACH;AA5EL;AAAA;AAAA,WA8EI,yBAAwBE,EAAxB,EAAkD;AAC9C,WAAKtB,aAAL,CAAmBC,IAAnB,CAAwBqB,EAAxB;AACH;AAhFL;AAAA;AAAA,WAkFI,mBAAUC,MAAV,EAA4B;AACxB,WAAK7B,OAAL,GAAe6B,MAAf;AACH;AApFL;AAAA;AAAA,WAsFI,qBAAY;AACR,aAAO,KAAK7B,OAAZ;AACH;AAxFL;AAAA;AAAA,WA0FI,mBAAUW,MAAV,EAA6B;AACzB,WAAKmB,OAAL,GAAenB,MAAf;AACH;AA5FL;AAAA;AAAA,WA8FI,qBAAuB;AACnB,aAAO,KAAKmB,OAAZ;AACH;AAhGL;AAAA;AAAA,WAkGI,yBAAuDf,IAAvD,EAAsF;AAClF,UAAIJ,MAAM,GAAG,KAAKC,SAAL,EAAb;;AACA,aAAOD,MAAP,EAAe;AACX,YAAIA,MAAM,YAAaI,IAAvB,EAAqC;AACjC;AACH;;AAEDJ,QAAAA,MAAM,GAAGA,MAAM,CAACC,SAAP,EAAT;AACH;;AAED,aAAOD,MAAP;AACH;AA7GL;AAAA;AAAA,WA+GI,6BAAoBoB,GAApB,EAA8C;AAC1C,UAAMC,QAAQ,GAAGC,KAAK,CAACC,IAAN,CAAW,KAAKC,SAAL,CAAeC,MAAf,EAAX,CAAjB,CAD0C,CAG1C;;AACA,mCAAsBJ,QAAtB,+BAAgC;AAA3B,YAAMK,QAAO,gBAAb;;AACD,YAAIA,QAAO,YAAY5C,SAAvB,EAAkC;AAC9B,cAAM6C,QAAQ,GAAGD,QAAO,CAACE,WAAR,EAAjB;;AAD8B,qDAEVD,QAFU;AAAA;;AAAA;AAE9B,gEAA8B;AAAA,kBAAnBE,KAAmB;AAC1BA,cAAAA,KAAK,CAACC,mBAAN,CAA0BV,GAA1B,EAA+BP,OAA/B,CAAuC,UAAAkB,EAAE;AAAA,uBAAIV,QAAQ,CAACzB,IAAT,CAAcmC,EAAd,CAAJ;AAAA,eAAzC;AACH;AAJ6B;AAAA;AAAA;AAAA;AAAA;AAKjC;AACJ;;AACD,aAAOV,QAAQ,CAACX,MAAT,CAAgB,UAAAqB,EAAE;AAAA,eAAIA,EAAE,CAACC,MAAH,CAAUZ,GAAV,CAAJ;AAAA,OAAlB,CAAP;AACH;AA5HL;AAAA;AAAA,WA8HI,8BACIhB,IADJ,EAEc;AACV,UAAMiB,QAAQ,GAAGC,KAAK,CAACC,IAAN,CAAW,KAAKC,SAAL,CAAeC,MAAf,EAAX,CAAjB,CADU,CAGV;;AACA,qCAAsBJ,QAAtB,kCAAgC;AAA3B,YAAMK,SAAO,kBAAb;;AACD,YAAMC,QAAQ,GAAGD,SAAO,CAACE,WAAR,EAAjB;;AAD4B,oDAERD,QAFQ;AAAA;;AAAA;AAE5B,iEAA8B;AAAA,gBAAnBE,KAAmB;AAC1BA,YAAAA,KAAK,CAACI,oBAAN,CAA2B7B,IAA3B,EAAiCS,OAAjC,CAAyC,UAAAkB,EAAE,EAAI;AAC3CV,cAAAA,QAAQ,CAACzB,IAAT,CAAcmC,EAAd;AACH,aAFD;AAGH;AAN2B;AAAA;AAAA;AAAA;AAAA;AAO/B;;AAED,aAAOV,QAAQ,CAACX,MAAT,CAAgB,UAAAqB,EAAE;AAAA,eAAIA,EAAE,YAAY3B,IAAlB;AAAA,OAAlB,CAAP;AACH;AA9IL;AAAA;AAAA,WAgJI,gBAAOgB,GAAP,EAAoB;AAChB,WAAK3B,KAAL,CAAWyC,GAAX,CAAed,GAAf;AACH;AAlJL;AAAA;AAAA,WAoJI,gBAAOA,GAAP,EAAoB;AAChB,aAAO,KAAK3B,KAAL,CAAW0C,GAAX,CAAef,GAAf,CAAP;AACH;AAtJL;AAAA;AAAA,WAwJI,mBAAUA,GAAV,EAAuB;AACnB,WAAK3B,KAAL,CAAW2C,MAAX,CAAkBhB,GAAlB;AACH;AA1JL;AAAA;AAAA,WA4JI,mBAA4E;AAAA,UAArChB,IAAqC,uEAAfxB,MAAe;AACxE,UAAIoB,MAAM,GAAG,KAAKC,SAAL,EAAb;;AACA,aAAOD,MAAM,IAAI,EAAEA,MAAM,YAAYI,IAApB,CAAjB,EAA4C;AACxCJ,QAAAA,MAAM,GAAGA,MAAM,CAACC,SAAP,EAAT;AACH;;AAED,aAAOD,MAAP;AACH;AAnKL;AAAA;AAAA,WAqKI,oBAAmD0B,OAAnD,EAAgF;AAC5EA,MAAAA,OAAO,CAACW,SAAR,CAAkB,IAAlB,EAD4E,CAG5E;;AACA,UAAI,CAAC,KAAKb,SAAL,CAAeW,GAAf,CAAmBT,OAAO,CAAC3C,EAA3B,CAAL,EAAqC;AACjC,aAAKM,OAAL,CAAaiD,qBAAb,CAAmCZ,OAAnC;AACH;;AAED,WAAKF,SAAL,CAAee,GAAf,CAAmBb,OAAO,CAAC3C,EAA3B,EAA+B2C,OAA/B;;AAEA,aAAOA,OAAP;AACH;AAhLL;AAAA;AAAA,WAkLI,iBAAQc,IAAR,EAAuB;AACnB,WAAKnD,OAAL,CAAaoD,OAAb,CAAqBD,IAArB;AACH;AApLL;AAAA;AAAA,WAsLI,oBAA4CzD,EAA5C,EAA2D;AACvD,UAAM2D,UAAU,GAAG,KAAKlB,SAAL,CAAemB,GAAf,CAAmB5D,EAAnB,CAAnB;;AACA,UAAI2D,UAAJ,EAAgB;AACZ,eAAOA,UAAP;AACH,OAJsD,CAMvD;;;AACA,UAAMrB,QAAQ,GAAG,KAAKG,SAAL,CAAeC,MAAf,EAAjB;;AAPuD,kDAQjCJ,QARiC;AAAA;;AAAA;AAQvD,+DAAgC;AAAA,cAArBK,SAAqB;;AAC5B,cAAIA,SAAO,YAAY5C,SAAvB,EAAkC;AAC9B,gBAAM8D,UAAU,GAAGlB,SAAO,CAACnC,UAAR,CAAsBR,EAAtB,CAAnB;;AACA,gBAAI6D,UAAJ,EAAgB;AACZ,qBAAOA,UAAP;AACH;AACJ;AACJ;AAfsD;AAAA;AAAA;AAAA;AAAA;;AAiBvD,aAAO,IAAP;AACH;AAxML;AAAA;AAAA,WA0MI,uBAA2B;AACvB,aAAOtB,KAAK,CAACC,IAAN,CAAW,KAAKC,SAAL,CAAeC,MAAf,EAAX,CAAP;AACH;AA5ML;AAAA;AAAA,WA8MI,kBAASoB,aAAT,EAAmC;AAC/B,UAAM7C,MAAM,GAAG,KAAKC,SAAL,EAAf;;AACA,UAAID,MAAJ,EAAY;AACRA,QAAAA,MAAM,CAAC8C,MAAP,CAAc,IAAd;AACH;;AACDD,MAAAA,aAAa,CAACE,UAAd,CAAyB,IAAzB;AACH;AApNL;AAAA;AAAA,WAsNI,mBAAUF,aAAV,EAAoC;AAChC,UAAM7C,MAAM,GAAG,KAAKC,SAAL,EAAf;;AACA,UAAID,MAAJ,EAAY;AACRA,QAAAA,MAAM,CAAC8C,MAAP,CAAc,IAAd;AACH;;AACDD,MAAAA,aAAa,CAAC5C,SAAd,GAA0B+C,kBAA1B,CAA6CH,aAA7C,EAA4D,IAA5D;AACH;AA5NL;AAAA;AAAA,WA8NI,oBAAWA,aAAX,EAAqC;AACjC,UAAM7C,MAAM,GAAG,KAAKC,SAAL,EAAf;;AACA,UAAID,MAAJ,EAAY;AACRA,QAAAA,MAAM,CAAC8C,MAAP,CAAc,IAAd;AACH;;AACDD,MAAAA,aAAa,CAAC5C,SAAd,GAA0BgD,mBAA1B,CAA8CJ,aAA9C,EAA6D,IAA7D;AACH;AApOL;AAAA;AAAA,WAsOI,mBAAUA,aAAV,EAAoC;AAChC,UAAM7C,MAAM,GAAG,KAAKC,SAAL,EAAf;;AACA,UAAID,MAAJ,EAAY;AACRA,QAAAA,MAAM,CAAC8C,MAAP,CAAc,IAAd;AACH;;AACDD,MAAAA,aAAa,CAAC5C,SAAd,GAA0BiD,kBAA1B,CAA6CL,aAA7C,EAA4D,IAA5D;AACH;AA5OL;AAAA;AAAA,WA8OI,mBAAUA,aAAV,EAAoC;AAChC,UAAM7C,MAAM,GAAG,KAAKC,SAAL,EAAf;;AACA,UAAID,MAAJ,EAAY;AACRA,QAAAA,MAAM,CAAC8C,MAAP,CAAc,IAAd;AACH;;AACDD,MAAAA,aAAa,CAAC5C,SAAd,GAA0BkD,kBAA1B,CAA6CN,aAA7C,EAA4D,IAA5D;AACH;AApPL;AAAA;AAAA,WAsPI,8BAAqBA,aAArB,EAA+C;AAC3C,UAAM7C,MAAM,GAAG,KAAKC,SAAL,EAAf;;AACA,UAAID,MAAJ,EAAY;AACRA,QAAAA,MAAM,CAAC8C,MAAP,CAAc,IAAd;AACH;;AACDD,MAAAA,aAAa,CAACO,2BAAd,CAA0C,IAA1C;AACH;AA5PL;AAAA;AAAA,WA8PI,wBAAeP,aAAf,EAAyC;AACrC,UAAM7C,MAAM,GAAG,KAAKC,SAAL,EAAf;;AACA,UAAID,MAAJ,EAAY;AACRA,QAAAA,MAAM,CAAC8C,MAAP,CAAc,IAAd;AACH;;AACDD,MAAAA,aAAa,CAACP,qBAAd,CAAoC,IAApC;AACH;AApQL;AAAA;AAAA,WAsQI,gBAAOZ,OAAP,EAAuC;AACnC,UAAI,CAACA,OAAL,EAAc;AACV;AACA,aAAK2B,MAAL,CAAY,SAAZ;AACA,aAAKpD,SAAL,GAAiB6C,MAAjB,CAAwB,IAAxB;AACA;AACH;;AAEDpB,MAAAA,OAAO,CAAC2B,MAAR,CAAe,SAAf;;AACA,WAAK7B,SAAL,CAAeY,MAAf,CAAsBV,OAAO,CAAC3C,EAA9B;;AACA,WAAKM,OAAL,CAAaiE,aAAb,CAA2B5B,OAA3B;AACH;AAjRL;AAAA;AAAA;AAAA,iFAmRI;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,iDACWlD,QAAQ,CAAC;AAAA,yBAAM,MAAI,CAAC+E,OAAL,OAAmBC,SAAzB;AAAA,iBAAD,EAAqC;AAAEC,kBAAAA,QAAQ,EAAE;AAAZ,iBAArC,CADnB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAnRJ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,WAuRI,gBAAOC,KAAP,EAAqC;AAAA;;AACjC,UAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAAAD,KAAK,EAAI;AAC5B,eAAO,MAAI,CAACrE,OAAL,CAAauE,MAAb,CAAoBF,KAApB,EAA2B,MAAI,CAACG,aAAhC,CAAP;AACH,OAFD;;AAIA,UAAMC,SAA4B,GAAG,mBAAI,KAAK9C,UAAT,EAAqBN,MAArB,CAA4B,UAAAqD,EAAE;AAAA,eAC/DA,EAAE,CAACC,SAAH,CAAa,MAAb,EAAmBN,KAAnB,CAD+D;AAAA,OAA9B,CAArC;;AAIA,UAAMO,KAAI,GAAG,SAAPA,KAAO,CAACP,KAAD,EAAgB;AACzB,YAAII,SAAS,CAACI,MAAV,GAAmB,CAAvB,EAA0B;AACtB,iBAAOJ,SAAS,CAACK,GAAV,GAAgBP,MAAhB,CAAuB;AAC1BlC,YAAAA,OAAO,EAAE,MADiB;AAE1BgC,YAAAA,KAAK,EAALA,KAF0B;AAG1BO,YAAAA,IAAI,EAAE;AAAA,qBAAMA,KAAI,CAACP,KAAD,CAAV;AAAA,aAHoB;AAI1B/B,YAAAA,QAAQ,EAAE;AAAA,qBAAMgC,cAAc,CAACD,KAAD,CAApB;AAAA;AAJgB,WAAvB,CAAP;AAMH;;AACD,eAAOC,cAAc,CAACD,KAAD,CAArB;AACH,OAVD;;AAYA,aAAOO,KAAI,CAACP,KAAD,CAAX;AACH;AA7SL;AAAA;AAAA,WA+SI,qBAAYhC,OAAZ,EAAgC;AAC5B,UAAIA,OAAO,CAAC3C,EAAR,KAAe,KAAKA,EAAxB,EAA4B;AACxB,aAAKkB,SAAL,GAAiB8C,UAAjB,CAA4BrB,OAA5B;AACA;AACH;;AAEDA,MAAAA,OAAO,CAAC0C,SAAR,CAAkB,IAAlB;AACA,WAAKtB,MAAL;AACH;AAvTL;AAAA;AAAA,WAyTI,sBAAaY,KAAb,EAAoB;AAChB,UAAMhE,YAAY,sBAAO,KAAKC,aAAZ,CAAlB;;AACA,UAAMsE,MAAI,GAAG,SAAPA,MAAO,CAACP,KAAD,EAAgB;AACzB,eAAOhE,YAAY,CAACyE,GAAb,GAAmB;AAAET,UAAAA,KAAK,EAALA,KAAF;AAASO,UAAAA,IAAI,EAAE;AAAA,mBAAMA,MAAI,CAACP,KAAD,CAAV;AAAA;AAAf,SAAnB,CAAP;AACH,OAFD;;AAIA,aAAOO,MAAI,CAACP,KAAD,CAAX;AACH;AAhUL;AAAA;AAAA,WAkUI,4BAA6BW,OAA7B,EAAsD3C,OAAtD,EAA+E;AAC3EA,MAAAA,OAAO,CAACW,SAAR,CAAkB,IAAlB;;AACA,WAAKb,SAAL,CAAee,GAAf,CAAmBb,OAAO,CAAC3C,EAA3B,EAA+B2C,OAA/B;;AACA,WAAKrC,OAAL,CAAa6D,kBAAb,CAAgCmB,OAAhC,EAAyC3C,OAAzC;;AACA,aAAO,IAAP;AACH;AAvUL;AAAA;AAAA,WAyUI,4BAA6B2C,OAA7B,EAAsD3C,OAAtD,EAA+E;AAC3EA,MAAAA,OAAO,CAACW,SAAR,CAAkB,IAAlB;;AACA,WAAKb,SAAL,CAAee,GAAf,CAAmBb,OAAO,CAAC3C,EAA3B,EAA+B2C,OAA/B;;AACA,WAAKrC,OAAL,CAAa8D,kBAAb,CAAgCkB,OAAhC,EAAyC3C,OAAzC;;AACA,aAAO,IAAP;AACH;AA9UL;AAAA;AAAA,WAgVI,4BAA6B2C,OAA7B,EAAsD3C,OAAtD,EAA+E;AAC3EA,MAAAA,OAAO,CAACW,SAAR,CAAkB,IAAlB;;AACA,WAAKb,SAAL,CAAee,GAAf,CAAmBb,OAAO,CAAC3C,EAA3B,EAA+B2C,OAA/B;;AACA,WAAKrC,OAAL,CAAa2D,kBAAb,CAAgCqB,OAAhC,EAAyC3C,OAAzC;;AACA,aAAO,IAAP;AACH;AArVL;AAAA;AAAA,WAuVI,6BAA8B2C,OAA9B,EAAuD3C,OAAvD,EAAgF;AAC5EA,MAAAA,OAAO,CAACW,SAAR,CAAkB,IAAlB;;AACA,WAAKb,SAAL,CAAee,GAAf,CAAmBb,OAAO,CAAC3C,EAA3B,EAA+B2C,OAA/B;;AACA,WAAKrC,OAAL,CAAa4D,mBAAb,CAAiCoB,OAAjC,EAA0C3C,OAA1C;;AACA,aAAO,IAAP;AACH;AA5VL;AAAA;AAAA,WA8VI,qCAAsCA,OAAtC,EAA+D;AAC3DA,MAAAA,OAAO,CAACW,SAAR,CAAkB,IAAlB;;AACA,WAAKb,SAAL,CAAee,GAAf,CAAmBb,OAAO,CAAC3C,EAA3B,EAA+B2C,OAA/B;;AACA,WAAKrC,OAAL,CAAa+D,2BAAb,CAAyC1B,OAAzC;;AACA,aAAO,IAAP;AACH;AAnWL;AAAA;AAAA,WAqWI,+BAAgCA,OAAhC,EAAyD;AACrDA,MAAAA,OAAO,CAACW,SAAR,CAAkB,IAAlB;;AACA,WAAKb,SAAL,CAAee,GAAf,CAAmBb,OAAO,CAAC3C,EAA3B,EAA+B2C,OAA/B;;AACA,WAAKrC,OAAL,CAAaiD,qBAAb,CAAmCZ,OAAnC;;AACA,aAAO,IAAP;AACH;AA1WL;;AAAA;AAAA;AAiXA,WAAa4C,eAAb;AAAA;;AAAA;;AAKI,2BAAYnE,YAAZ,EAA2CW,KAA3C,EAA2E;AAAA;;AAAA;;AACvE;;AADuE;;AAAA;;AAGvE,WAAKyD,aAAL,GAAqBpE,YAArB;AACA,WAAKqE,MAAL,GAAc1D,KAAd;AAJuE;AAK1E;;AAVL;AAAA;AAAA,SAYI,eAAW;AACP,uCAA0B,KAAKyD,aAAL,CAAmBlE,SAAnB,CAA6BC,WAA7B,CAAyCC,IAAnE;AACH;AAdL;AAAA;AAAA,WAgBI,mBAAUJ,YAAV,EAA0C;AACtC;AACR;AACA;AACA;AACQ,aAAOA,YAAY,KAAK,KAAKoE,aAA7B;AACH;AAtBL;AAAA;AAAA,WAwBI,eAAM7C,OAAN,EAAyB;AACrB,WAAK8C,MAAL,CAAY9C,OAAZ;AACH;AA1BL;;AAAA;AAAA,EAAiEjD,MAAjE;;gBAAa6F,e,UAC6B,iB","sourcesContent":["import React from \"react\";\nimport pWaitFor from \"p-wait-for\";\nimport { Plugin, plugins } from \"@webiny/plugins\";\nimport { UILayout } from \"./UILayout\";\nimport { UIView } from \"./UIView\";\nimport { UIRenderer } from \"./UIRenderer\";\n\ntype Class<T> = new (...args: any[]) => T;\n\nexport interface ShouldRender<TProps = any> {\n    (params: { props: TProps; next: Function }): boolean;\n}\n\nexport interface UIElementConfig<TProps = any> {\n    shouldRender?: ShouldRender<TProps>;\n    tags?: string[];\n}\n\nfunction defaultShouldRender() {\n    return true;\n}\n\nexport class UIElement<TConfig extends UIElementConfig = UIElementConfig> {\n    protected _elements = new Map<string, UIElement>();\n    protected _layout: UILayout;\n    private _config: TConfig;\n    private _tags = new Set();\n    private _id: string;\n    private _parent: UIElement;\n    private _renderers: UIRenderer<any>[] = [];\n    private _shouldRender: ShouldRender[] = [defaultShouldRender];\n\n    constructor(id: string, config?: TConfig) {\n        this._id = id;\n        this._config = config || ({} as TConfig);\n        this._layout = new UILayout(elementId => this.getElement(elementId));\n\n        if (!config) {\n            return;\n        }\n\n        if (config.tags) {\n            this._tags = new Set(config.tags);\n        }\n\n        if (config.shouldRender) {\n            this._shouldRender.push(config.shouldRender);\n        }\n\n        this.applyPlugins(UIElement);\n    }\n\n    get id() {\n        return this._id;\n    }\n\n    isGridEnabled() {\n        return this._layout.getGrid();\n    }\n\n    get config(): TConfig {\n        return this._config;\n    }\n\n    get depth() {\n        let depth = 0;\n\n        let parent = this.getParent();\n        while (parent && !(parent instanceof UIView)) {\n            depth++;\n            parent = parent.getParent();\n        }\n\n        return depth;\n    }\n\n    get hasParentGrid() {\n        let parent = this.getParent();\n        while (parent && !(parent instanceof UIView)) {\n            if (parent.isGridEnabled()) {\n                return true;\n            }\n            parent = parent.getParent();\n        }\n\n        return false;\n    }\n\n    applyPlugins(elementClass: Class<UIElement>) {\n        const type = `UIElementPlugin.${elementClass.prototype.constructor.name}`;\n        const elPlugins = plugins.byType<UIElementPlugin<any>>(type);\n        elPlugins\n            .filter(plugin => plugin.canHandle(elementClass))\n            .forEach(plugin => plugin.apply(this));\n    }\n\n    addRenderer(renderer: UIRenderer<any>) {\n        this._renderers.push(renderer);\n    }\n\n    addShouldRender<TProps>(cb: ShouldRender<TProps>) {\n        this._shouldRender.push(cb);\n    }\n\n    setLayout(layout: UILayout) {\n        this._layout = layout;\n    }\n\n    getLayout() {\n        return this._layout;\n    }\n\n    setParent(parent: UIElement) {\n        this._parent = parent;\n    }\n\n    getParent(): UIElement {\n        return this._parent;\n    }\n\n    getParentByType<TParent extends UIElement = UIElement>(type: Class<TParent>): TParent {\n        let parent = this.getParent();\n        while (parent) {\n            if (parent instanceof (type as any)) {\n                break;\n            }\n\n            parent = parent.getParent();\n        }\n\n        return parent as TParent;\n    }\n\n    getDescendentsByTag(tag: string): UIElement[] {\n        const elements = Array.from(this._elements.values());\n\n        // Search child elements recursively\n        for (const element of elements) {\n            if (element instanceof UIElement) {\n                const children = element.getChildren();\n                for (const child of children) {\n                    child.getDescendentsByTag(tag).forEach(el => elements.push(el));\n                }\n            }\n        }\n        return elements.filter(el => el.hasTag(tag));\n    }\n\n    getDescendentsByType<TElement extends UIElement = UIElement>(\n        type: Class<TElement>\n    ): TElement[] {\n        const elements = Array.from(this._elements.values());\n\n        // Search child elements recursively\n        for (const element of elements) {\n            const children = element.getChildren();\n            for (const child of children) {\n                child.getDescendentsByType(type).forEach(el => {\n                    elements.push(el);\n                });\n            }\n        }\n\n        return elements.filter(el => el instanceof type) as TElement[];\n    }\n\n    addTag(tag: string) {\n        this._tags.add(tag);\n    }\n\n    hasTag(tag: string) {\n        return this._tags.has(tag);\n    }\n\n    removeTag(tag: string) {\n        this._tags.delete(tag);\n    }\n\n    getView<TView extends UIView = UIView>(type: Class<UIView> = UIView): TView {\n        let parent = this.getParent();\n        while (parent && !(parent instanceof type)) {\n            parent = parent.getParent();\n        }\n\n        return parent as TView;\n    }\n\n    addElement<TElement extends UIElement = UIElement>(element: TElement): TElement {\n        element.setParent(this);\n\n        // We only need to modify layout if we're adding a new element\n        if (!this._elements.has(element.id)) {\n            this._layout.insertElementAtTheEnd(element);\n        }\n\n        this._elements.set(element.id, element);\n\n        return element;\n    }\n\n    useGrid(flag: boolean) {\n        this._layout.setGrid(flag);\n    }\n\n    getElement<T extends UIElement = UIElement>(id: string): T {\n        const ownElement = this._elements.get(id);\n        if (ownElement) {\n            return ownElement as T;\n        }\n\n        // Search child elements recursively until an element is found\n        const elements = this._elements.values();\n        for (const element of elements) {\n            if (element instanceof UIElement) {\n                const descendant = element.getElement<T>(id);\n                if (descendant) {\n                    return descendant;\n                }\n            }\n        }\n\n        return null;\n    }\n\n    getChildren(): UIElement[] {\n        return Array.from(this._elements.values());\n    }\n\n    moveInto(targetElement: UIElement) {\n        const parent = this.getParent();\n        if (parent) {\n            parent.remove(this);\n        }\n        targetElement.addElement(this);\n    }\n\n    moveAfter(targetElement: UIElement) {\n        const parent = this.getParent();\n        if (parent) {\n            parent.remove(this);\n        }\n        targetElement.getParent().insertElementAfter(targetElement, this);\n    }\n\n    moveBefore(targetElement: UIElement) {\n        const parent = this.getParent();\n        if (parent) {\n            parent.remove(this);\n        }\n        targetElement.getParent().insertElementBefore(targetElement, this);\n    }\n\n    moveAbove(targetElement: UIElement) {\n        const parent = this.getParent();\n        if (parent) {\n            parent.remove(this);\n        }\n        targetElement.getParent().insertElementAbove(targetElement, this);\n    }\n\n    moveBelow(targetElement: UIElement) {\n        const parent = this.getParent();\n        if (parent) {\n            parent.remove(this);\n        }\n        targetElement.getParent().insertElementBelow(targetElement, this);\n    }\n\n    moveToTheBeginningOf(targetElement: UIElement) {\n        const parent = this.getParent();\n        if (parent) {\n            parent.remove(this);\n        }\n        targetElement.insertElementAtTheBeginning(this);\n    }\n\n    moveToTheEndOf(targetElement: UIElement) {\n        const parent = this.getParent();\n        if (parent) {\n            parent.remove(this);\n        }\n        targetElement.insertElementAtTheEnd(this);\n    }\n\n    remove(element?: UIElement<any>): void {\n        if (!element) {\n            // Delete self\n            this.addTag(\"removed\");\n            this.getParent().remove(this);\n            return;\n        }\n\n        element.addTag(\"removed\");\n        this._elements.delete(element.id);\n        this._layout.removeElement(element);\n    }\n\n    async isRendered() {\n        return pWaitFor(() => this.getView() !== undefined, { interval: 50 });\n    }\n\n    render(props?: any): React.ReactNode {\n        const layoutRenderer = props => {\n            return this._layout.render(props, this.hasParentGrid);\n        };\n\n        const renderers: UIRenderer<any>[] = [...this._renderers].filter(pl =>\n            pl.canRender(this, props)\n        );\n\n        const next = (props: any) => {\n            if (renderers.length > 0) {\n                return renderers.pop().render({\n                    element: this,\n                    props,\n                    next: () => next(props),\n                    children: () => layoutRenderer(props)\n                });\n            }\n            return layoutRenderer(props);\n        };\n\n        return next(props);\n    }\n\n    replaceWith(element: UIElement) {\n        if (element.id === this.id) {\n            this.getParent().addElement(element);\n            return;\n        }\n\n        element.moveAfter(this);\n        this.remove();\n    }\n\n    shouldRender(props) {\n        const shouldRender = [...this._shouldRender];\n        const next = (props: any) => {\n            return shouldRender.pop()({ props, next: () => next(props) });\n        };\n\n        return next(props);\n    }\n\n    protected insertElementAbove(lookFor: UIElement<any>, element: UIElement<any>) {\n        element.setParent(this);\n        this._elements.set(element.id, element);\n        this._layout.insertElementAbove(lookFor, element);\n        return this;\n    }\n\n    protected insertElementBelow(lookFor: UIElement<any>, element: UIElement<any>) {\n        element.setParent(this);\n        this._elements.set(element.id, element);\n        this._layout.insertElementBelow(lookFor, element);\n        return this;\n    }\n\n    protected insertElementAfter(lookFor: UIElement<any>, element: UIElement<any>) {\n        element.setParent(this);\n        this._elements.set(element.id, element);\n        this._layout.insertElementAfter(lookFor, element);\n        return this;\n    }\n\n    protected insertElementBefore(lookFor: UIElement<any>, element: UIElement<any>) {\n        element.setParent(this);\n        this._elements.set(element.id, element);\n        this._layout.insertElementBefore(lookFor, element);\n        return this;\n    }\n\n    protected insertElementAtTheBeginning(element: UIElement<any>) {\n        element.setParent(this);\n        this._elements.set(element.id, element);\n        this._layout.insertElementAtTheBeginning(element);\n        return this;\n    }\n\n    protected insertElementAtTheEnd(element: UIElement<any>) {\n        element.setParent(this);\n        this._elements.set(element.id, element);\n        this._layout.insertElementAtTheEnd(element);\n        return this;\n    }\n}\n\nexport interface ApplyFunction<TElement> {\n    (element: TElement): void;\n}\n\nexport class UIElementPlugin<TElement extends UIElement> extends Plugin {\n    public static readonly type: string = \"UIElementPlugin\";\n    private _apply: ApplyFunction<TElement>;\n    private _elementClass: Class<TElement>;\n\n    constructor(elementClass: Class<TElement>, apply: ApplyFunction<TElement>) {\n        super();\n\n        this._elementClass = elementClass;\n        this._apply = apply;\n    }\n\n    get type() {\n        return `UIElementPlugin.${this._elementClass.prototype.constructor.name}`;\n    }\n\n    canHandle(elementClass: Class<UIElement>) {\n        /**\n         * We need to compare exact classes because we only want to run plugins for an exact class\n         * and not the entire inheritance tree.\n         */\n        return elementClass === this._elementClass;\n    }\n\n    apply(element: TElement) {\n        this._apply(element);\n    }\n}\n"],"file":"UIElement.js"}