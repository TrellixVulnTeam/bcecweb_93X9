import _objectSpread from "@babel/runtime/helpers/objectSpread2";
import _classCallCheck from "@babel/runtime/helpers/classCallCheck";
import _createClass from "@babel/runtime/helpers/createClass";
import _assertThisInitialized from "@babel/runtime/helpers/assertThisInitialized";
import _inherits from "@babel/runtime/helpers/inherits";
import _createSuper from "@babel/runtime/helpers/createSuper";
import _defineProperty from "@babel/runtime/helpers/defineProperty";
import { setContext } from "apollo-link-context";
import { ApolloLinkPlugin } from "./ApolloLinkPlugin";

/**
 * Append `x-i18n-locale` header from URL query (necessary for prerendering service).
 */
export var LocaleHeaderLinkPlugin = /*#__PURE__*/function (_ApolloLinkPlugin) {
  _inherits(LocaleHeaderLinkPlugin, _ApolloLinkPlugin);

  var _super = _createSuper(LocaleHeaderLinkPlugin);

  function LocaleHeaderLinkPlugin(locale) {
    var _this;

    _classCallCheck(this, LocaleHeaderLinkPlugin);

    _this = _super.call(this);

    _defineProperty(_assertThisInitialized(_this), "locale", void 0);

    if (!locale) {
      var query = new URLSearchParams(location.search);
      locale = query.get("__locale") || window.__PS_RENDER_LOCALE__;
    }

    _this.locale = locale;
    return _this;
  }

  _createClass(LocaleHeaderLinkPlugin, [{
    key: "createLink",
    value: function createLink() {
      var _this2 = this;

      return setContext(function (_, _ref) {
        var headers = _ref.headers;

        if (_this2.locale) {
          return {
            headers: _objectSpread(_objectSpread({}, headers), {}, {
              "x-i18n-locale": "content:".concat(_this2.locale, ";")
            })
          };
        }

        return {
          headers: headers
        };
      });
    }
  }]);

  return LocaleHeaderLinkPlugin;
}(ApolloLinkPlugin);
//# sourceMappingURL=LocaleHeaderLinkPlugin.js.map