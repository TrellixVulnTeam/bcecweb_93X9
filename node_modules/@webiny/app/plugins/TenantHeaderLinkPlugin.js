import _objectSpread from "@babel/runtime/helpers/objectSpread2";
import _classCallCheck from "@babel/runtime/helpers/classCallCheck";
import _createClass from "@babel/runtime/helpers/createClass";
import _assertThisInitialized from "@babel/runtime/helpers/assertThisInitialized";
import _inherits from "@babel/runtime/helpers/inherits";
import _createSuper from "@babel/runtime/helpers/createSuper";
import _defineProperty from "@babel/runtime/helpers/defineProperty";
import { setContext } from "apollo-link-context";
import { ApolloLinkPlugin } from "./ApolloLinkPlugin";

/**
 * Append `x-tenant` header from URL query (necessary for prerendering service).
 */
export var TenantHeaderLinkPlugin = /*#__PURE__*/function (_ApolloLinkPlugin) {
  _inherits(TenantHeaderLinkPlugin, _ApolloLinkPlugin);

  var _super = _createSuper(TenantHeaderLinkPlugin);

  function TenantHeaderLinkPlugin(tenant) {
    var _this;

    _classCallCheck(this, TenantHeaderLinkPlugin);

    _this = _super.call(this);

    _defineProperty(_assertThisInitialized(_this), "tenant", void 0);

    _this.name = "tenant-header-link";

    if (!tenant) {
      var query = new URLSearchParams(location.search);
      tenant = query.get("__tenant") || window.__PS_RENDER_TENANT__;
    }

    _this.tenant = tenant;
    return _this;
  }

  _createClass(TenantHeaderLinkPlugin, [{
    key: "createLink",
    value: function createLink() {
      var _this2 = this;

      return setContext(function (_, _ref) {
        var headers = _ref.headers;

        if (_this2.tenant) {
          return {
            headers: _objectSpread(_objectSpread({}, headers), {}, {
              "x-tenant": _this2.tenant
            })
          };
        }

        return {
          headers: headers
        };
      });
    }
  }]);

  return TenantHeaderLinkPlugin;
}(ApolloLinkPlugin);
//# sourceMappingURL=TenantHeaderLinkPlugin.js.map