{"version":3,"sources":["../../src/plugins/LocaleHeaderLinkPlugin.ts"],"names":["setContext","ApolloLinkPlugin","LocaleHeaderLinkPlugin","locale","query","URLSearchParams","location","search","get","window","__PS_RENDER_LOCALE__","_","headers"],"mappings":";;;;;;;AAAA,SAASA,UAAT,QAA2B,qBAA3B;AACA,SAASC,gBAAT;;AAQA;AACA;AACA;AACA,WAAaC,sBAAb;AAAA;;AAAA;;AAGI,kCAAYC,MAAZ,EAA6B;AAAA;;AAAA;;AACzB;;AADyB;;AAGzB,QAAI,CAACA,MAAL,EAAa;AACT,UAAMC,KAAK,GAAG,IAAIC,eAAJ,CAAoBC,QAAQ,CAACC,MAA7B,CAAd;AACAJ,MAAAA,MAAM,GAAGC,KAAK,CAACI,GAAN,CAAU,UAAV,KAAyBC,MAAM,CAACC,oBAAzC;AACH;;AAED,UAAKP,MAAL,GAAcA,MAAd;AARyB;AAS5B;;AAZL;AAAA;AAAA,WAcI,sBAAa;AAAA;;AACT,aAAOH,UAAU,CAAC,UAACW,CAAD,QAAoB;AAAA,YAAdC,OAAc,QAAdA,OAAc;;AAClC,YAAI,MAAI,CAACT,MAAT,EAAiB;AACb,iBAAO;AACHS,YAAAA,OAAO,kCACAA,OADA;AAEH,iDAA4B,MAAI,CAACT,MAAjC;AAFG;AADJ,WAAP;AAMH;;AAED,eAAO;AAAES,UAAAA,OAAO,EAAPA;AAAF,SAAP;AACH,OAXgB,CAAjB;AAYH;AA3BL;;AAAA;AAAA,EAA4CX,gBAA5C","sourcesContent":["import { setContext } from \"apollo-link-context\";\nimport { ApolloLinkPlugin } from \"./ApolloLinkPlugin\";\n\ndeclare global {\n    interface Window {\n        __PS_RENDER_LOCALE__: string;\n    }\n}\n\n/**\n * Append `x-i18n-locale` header from URL query (necessary for prerendering service).\n */\nexport class LocaleHeaderLinkPlugin extends ApolloLinkPlugin {\n    private locale: string;\n\n    constructor(locale?: string) {\n        super();\n\n        if (!locale) {\n            const query = new URLSearchParams(location.search);\n            locale = query.get(\"__locale\") || window.__PS_RENDER_LOCALE__;\n        }\n\n        this.locale = locale;\n    }\n\n    createLink() {\n        return setContext((_, { headers }) => {\n            if (this.locale) {\n                return {\n                    headers: {\n                        ...headers,\n                        \"x-i18n-locale\": `content:${this.locale};`\n                    }\n                };\n            }\n\n            return { headers };\n        });\n    }\n}\n"],"file":"LocaleHeaderLinkPlugin.js"}