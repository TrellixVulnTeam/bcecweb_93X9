{"version":3,"sources":["../../../src/plugins/definitions/AttributePlugin.ts"],"names":["reservedFields","AttributePlugin","Plugin","entity","_entity","attribute","_attribute","constructor","params","validateReserved","_params","getDefinition","includes","WebinyError"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AAMA,MAAMA,cAAc,GAAG,CAAC,IAAD,EAAO,IAAP,EAAa,OAAb,EAAsB,MAAtB,CAAvB;;AAUO,MAAeC,eAAf,SAAuCC,eAAvC,CAA8C;AAMhC,MAANC,MAAM,GAAW;AACxB,WAAO,KAAKC,OAAZ;AACH;;AAEmB,MAATC,SAAS,GAAW;AAC3B,WAAO,KAAKC,UAAZ;AACH;;AAEMC,EAAAA,WAAW,CAAC;AAAEJ,IAAAA,MAAF;AAAUE,IAAAA,SAAV;AAAqBG,IAAAA;AAArB,GAAD,EAAwC;AACtD;AADsD;AAAA;AAAA;AAGtD,SAAKC,gBAAL,CAAsBJ,SAAtB;AAEA,SAAKD,OAAL,GAAeD,MAAf;AACA,SAAKG,UAAL,GAAkBD,SAAlB;AACA,SAAKK,OAAL,GAAeF,MAAf;AACH;;AAEMG,EAAAA,aAAa,GAAqC;AACrD,WAAO;AACH,OAAC,KAAKN,SAAN,GAAkB,KAAKK;AADpB,KAAP;AAGH;;AAEOD,EAAAA,gBAAgB,CAACJ,SAAD,EAA0B;AAC9C,QAAIL,cAAc,CAACY,QAAf,CAAwBP,SAAxB,MAAuC,KAA3C,EAAkD;AAC9C;AACH;;AACD,UAAM,IAAIQ,cAAJ,CACD,mBAAkBR,SAAU,mBAD3B,EAEF,uBAFE,EAGF;AACIA,MAAAA;AADJ,KAHE,CAAN;AAOH;;AAzCgD;;;8BAA/BJ,e,UACY,uB","sourcesContent":["import { Plugin } from \"@webiny/plugins\";\nimport WebinyError from \"@webiny/error\";\nimport { DynamoDBTypes } from \"dynamodb-toolbox/dist/classes/Table\";\nimport {\n    EntityAttributeConfig,\n    EntityCompositeAttributes\n} from \"dynamodb-toolbox/dist/classes/Entity\";\nconst reservedFields = [\"PK\", \"SK\", \"index\", \"data\"];\n\nexport type DefinitionParams = DynamoDBTypes | EntityAttributeConfig | EntityCompositeAttributes;\n\nexport interface Params {\n    entity: string;\n    attribute: string;\n    params: DefinitionParams;\n}\n\nexport abstract class AttributePlugin extends Plugin {\n    public static readonly type = \"db.dynamodb.attribute\";\n    private readonly _entity: string;\n    private readonly _attribute: string;\n    private readonly _params: DefinitionParams;\n\n    public get entity(): string {\n        return this._entity;\n    }\n\n    public get attribute(): string {\n        return this._attribute;\n    }\n\n    public constructor({ entity, attribute, params }: Params) {\n        super();\n\n        this.validateReserved(attribute);\n\n        this._entity = entity;\n        this._attribute = attribute;\n        this._params = params;\n    }\n\n    public getDefinition(): Record<string, DefinitionParams> {\n        return {\n            [this.attribute]: this._params\n        };\n    }\n\n    private validateReserved(attribute: string): void {\n        if (reservedFields.includes(attribute) === false) {\n            return;\n        }\n        throw new WebinyError(\n            `Attribute name \"${attribute}\" is not allowed.`,\n            \"ATTRIBUTE_NOT_ALLOWED\",\n            {\n                attribute\n            }\n        );\n    }\n}\n"],"file":"AttributePlugin.js"}