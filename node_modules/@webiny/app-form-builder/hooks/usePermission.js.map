{"version":3,"sources":["../../src/hooks/usePermission.ts"],"names":["useCallback","useMemo","useSecurity","get","usePermission","identity","fbFormPermission","getPermission","hasFullAccess","canEdit","item","creatorId","own","login","rwd","includes","canDelete","createdBy","id","canPublish","pw","canUnpublish"],"mappings":"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","sourcesContent":["import { useCallback, useMemo } from \"react\";\nimport { useSecurity } from \"@webiny/app-security\";\nimport get from \"lodash/get\";\n\nconst usePermission = () => {\n    const { identity } = useSecurity();\n\n    const fbFormPermission = useMemo(() => identity.getPermission(\"fb.form\"), []);\n    const hasFullAccess = useMemo(() => identity.getPermission(\"fb.*\"), []);\n\n    const canEdit = useCallback(\n        item => {\n            const creatorId = get(item, \"createdBy.id\");\n            if (!fbFormPermission) {\n                return false;\n            }\n            if (fbFormPermission.own && creatorId) {\n                return creatorId === identity.login;\n            }\n            if (typeof fbFormPermission.rwd === \"string\") {\n                return fbFormPermission.rwd.includes(\"w\");\n            }\n            return true;\n        },\n        [fbFormPermission]\n    );\n\n    const canDelete = useCallback(\n        item => {\n            if (!fbFormPermission) {\n                return false;\n            }\n            if (fbFormPermission.own) {\n                return item.createdBy.id === identity.login;\n            }\n            if (typeof fbFormPermission.rwd === \"string\") {\n                return fbFormPermission.rwd.includes(\"d\");\n            }\n            return true;\n        },\n        [fbFormPermission]\n    );\n\n    const canPublish = useCallback(() => {\n        if (hasFullAccess) {\n            return true;\n        }\n        if (!fbFormPermission) {\n            return false;\n        }\n        if (typeof fbFormPermission.pw === \"string\") {\n            return fbFormPermission.pw.includes(\"p\");\n        }\n        return fbFormPermission.pw;\n    }, [fbFormPermission, hasFullAccess]);\n\n    const canUnpublish = useCallback(() => {\n        if (hasFullAccess) {\n            return true;\n        }\n        if (!fbFormPermission) {\n            return false;\n        }\n        if (typeof fbFormPermission.pw === \"string\") {\n            return fbFormPermission.pw.includes(\"u\");\n        }\n        return fbFormPermission.pw;\n    }, [fbFormPermission, hasFullAccess]);\n\n    return {\n        canEdit,\n        canDelete,\n        canPublish,\n        canUnpublish\n    };\n};\n\nexport default usePermission;\n"],"file":"usePermission.js"}