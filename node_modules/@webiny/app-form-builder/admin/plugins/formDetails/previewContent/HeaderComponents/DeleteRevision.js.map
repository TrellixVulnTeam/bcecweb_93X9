{"version":3,"sources":["../../../../../../src/admin/plugins/formDetails/previewContent/HeaderComponents/DeleteRevision.tsx"],"names":["React","useApolloClient","useRouter","useSnackbar","IconButton","Tooltip","ConfirmationDialog","queries","removeFormFromListCache","removeRevisionFromFormCache","updateLatestRevisionInListCache","usePermission","DeleteRevision","revisions","form","revision","selectRevision","showSnackbar","client","history","canDelete","message","lastRevision","length","showConfirmation","mutate","mutation","DELETE_FORM","DELETE_REVISION","variables","id","update","cache","data","error","formBuilder","deleteForm","push","firstRevision","encodeURIComponent"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { useApolloClient } from \"@apollo/react-hooks\";\nimport { useRouter } from \"@webiny/react-router\";\nimport { useSnackbar } from \"@webiny/app-admin/hooks/useSnackbar\";\nimport { IconButton } from \"@webiny/ui/Button\";\nimport { Tooltip } from \"@webiny/ui/Tooltip\";\nimport { ConfirmationDialog } from \"@webiny/ui/ConfirmationDialog\";\nimport { ReactComponent as DeleteIcon } from \"../../../../icons/delete.svg\";\nimport * as queries from \"../../../../graphql\";\nimport {\n    removeFormFromListCache,\n    removeRevisionFromFormCache,\n    updateLatestRevisionInListCache\n} from \"../../../../views/cache\";\nimport usePermission from \"../../../../../hooks/usePermission\";\n\nconst DeleteRevision = ({ revisions, form, revision, selectRevision }) => {\n    const { showSnackbar } = useSnackbar();\n    const client = useApolloClient();\n    const { history } = useRouter();\n    const { canDelete } = usePermission();\n\n    // Render nothing is user doesn't have required permission.\n    if (!canDelete(form)) {\n        return null;\n    }\n\n    let message = \"You are about to delete this form revision, are you sure want to continue?\";\n    const lastRevision = revisions.length === 1;\n    if (lastRevision) {\n        message = \"You are about to delete this form. Are you sure want to continue?\";\n    }\n\n    return (\n        <Tooltip content={\"Delete\"} placement={\"top\"}>\n            <ConfirmationDialog\n                title={\"Confirmation required!\"}\n                message={message}\n                data-testid={\"fb.form-preview.header.delete-dialog\"}\n            >\n                {({ showConfirmation }) => (\n                    <IconButton\n                        data-testid={\"fb.form-preview.header.delete\"}\n                        icon={<DeleteIcon />}\n                        onClick={() =>\n                            showConfirmation(async () => {\n                                await client.mutate({\n                                    mutation: lastRevision\n                                        ? queries.DELETE_FORM\n                                        : queries.DELETE_REVISION,\n                                    variables: lastRevision\n                                        ? { id: revision.id }\n                                        : { revision: revision.id },\n                                    update: (cache, { data }) => {\n                                        const { error } = data.formBuilder.deleteForm;\n                                        if (error) {\n                                            return showSnackbar(error.message);\n                                        }\n\n                                        showSnackbar(\n                                            `${\n                                                lastRevision ? \"Form\" : \"Revision\"\n                                            } was deleted successfully!`\n                                        );\n\n                                        if (lastRevision) {\n                                            removeFormFromListCache(cache, form);\n\n                                            // Redirect\n                                            return history.push(\"/form-builder/forms\");\n                                        }\n\n                                        // We have other revisions, update form's cache\n                                        const revisions = removeRevisionFromFormCache(\n                                            cache,\n                                            form,\n                                            revision\n                                        );\n\n                                        updateLatestRevisionInListCache(cache, revisions[0]);\n\n                                        // Redirect to the first revision in the list of all form revisions.\n                                        const firstRevision = revisions[0];\n                                        selectRevision(firstRevision);\n                                        if (revision.id === form.id) {\n                                            return history.push(\n                                                `/form-builder/forms?id=${encodeURIComponent(\n                                                    firstRevision.id\n                                                )}`\n                                            );\n                                        }\n                                    }\n                                });\n                            })\n                        }\n                    />\n                )}\n            </ConfirmationDialog>\n        </Tooltip>\n    );\n};\n\nexport default DeleteRevision;\n"],"file":"DeleteRevision.js"}