{"version":3,"sources":["../../../../../src/admin/plugins/formDetails/formRevisions/Revision.tsx"],"names":["React","css","TimeAgo","ListItem","ListItemText","ListItemTextPrimary","ListItemTextSecondary","ListItemGraphic","ListItemMeta","IconButton","Icon","MenuItem","Menu","MenuDivider","ConfirmationDialog","Tooltip","useRevision","usePermission","primaryColor","color","revisionsMenu","width","right","left","getIcon","rev","status","icon","text","Revision","props","revision","form","tooltipText","publishRevision","createRevision","deleteRevision","editRevision","unpublishRevision","canPublish","canUnpublish","canDelete","canEdit","showMenu","name","savedOn","version","showConfirmation"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { css } from \"emotion\";\nimport TimeAgo from \"timeago-react\";\nimport {\n    ListItem,\n    ListItemText,\n    ListItemTextPrimary,\n    ListItemTextSecondary,\n    ListItemGraphic,\n    ListItemMeta\n} from \"@webiny/ui/List\";\nimport { IconButton } from \"@webiny/ui/Button\";\nimport { Icon } from \"@webiny/ui/Icon\";\nimport { MenuItem, Menu, MenuDivider } from \"@webiny/ui/Menu\";\nimport { ConfirmationDialog } from \"@webiny/ui/ConfirmationDialog\";\nimport { Tooltip } from \"@webiny/ui/Tooltip\";\nimport { ReactComponent as AddIcon } from \"../../../icons/add.svg\";\nimport { ReactComponent as BeenHereIcon } from \"../../../icons/beenhere.svg\";\nimport { ReactComponent as DeleteIcon } from \"../../../icons/delete.svg\";\nimport { ReactComponent as EditIcon } from \"../../../icons/edit.svg\";\nimport { ReactComponent as GestureIcon } from \"../../../icons/gesture.svg\";\nimport { ReactComponent as LockIcon } from \"../../../icons/lock.svg\";\nimport { ReactComponent as MoreVerticalIcon } from \"../../../icons/more_vert.svg\";\nimport { ReactComponent as PublishIcon } from \"../../../icons/publish.svg\";\nimport { ReactComponent as UnpublishIcon } from \"../../../icons/unpublish.svg\";\nimport { useRevision } from \"./useRevision\";\nimport { FbFormModel } from \"../../../../types\";\nimport usePermission from \"../../../../hooks/usePermission\";\n\nconst primaryColor = css({ color: \"var(--mdc-theme-primary)\" });\n\nconst revisionsMenu = css({\n    width: 250,\n    right: -105,\n    left: \"auto !important\"\n});\n\nconst getIcon = rev => {\n    switch (rev.status) {\n        case \"locked\":\n            return {\n                icon: <Icon icon={<LockIcon />} />,\n                text: \"This revision is locked (it has already been published)\"\n            };\n        case \"published\":\n            return {\n                icon: <Icon icon={<BeenHereIcon />} className={primaryColor} />,\n                text: \"This revision is currently published!\"\n            };\n        default:\n            return {\n                icon: <Icon icon={<GestureIcon />} />,\n                text: \"This is a draft\"\n            };\n    }\n};\n\ntype RevisionProps = {\n    form: FbFormModel;\n    revision: FbFormModel;\n};\n\nconst Revision = (props: RevisionProps) => {\n    const { revision: rev, form } = props;\n    const { icon, text: tooltipText } = getIcon(rev);\n    const { publishRevision, createRevision, deleteRevision, editRevision, unpublishRevision } =\n        useRevision({\n            revision: rev,\n            form\n        });\n    const { canPublish, canUnpublish, canDelete, canEdit } = usePermission();\n\n    const showMenu = canEdit(form) || canDelete(form) || canPublish() || canUnpublish();\n\n    return (\n        <ListItem>\n            <ListItemGraphic>\n                <Tooltip content={tooltipText} placement={\"bottom\"}>\n                    {icon}\n                </Tooltip>\n            </ListItemGraphic>\n            <ListItemText>\n                <ListItemTextPrimary>{rev.name}</ListItemTextPrimary>\n                <ListItemTextSecondary>\n                    Last modified <TimeAgo datetime={rev.savedOn} /> (#\n                    {rev.version})\n                </ListItemTextSecondary>\n            </ListItemText>\n            {showMenu && (\n                <ListItemMeta>\n                    <Menu\n                        handle={<IconButton icon={<MoreVerticalIcon />} />}\n                        className={revisionsMenu}\n                        data-testid={\"fb.form-revisions.action-menu\"}\n                    >\n                        {canEdit(form) && (\n                            <MenuItem\n                                onClick={createRevision}\n                                data-testid={\"fb.form-revisions.action-menu.create-revision\"}\n                            >\n                                <ListItemGraphic>\n                                    <Icon icon={<AddIcon />} />\n                                </ListItemGraphic>\n                                New from current\n                            </MenuItem>\n                        )}\n                        {rev.status === \"draft\" && canEdit(form) && (\n                            <MenuItem\n                                onClick={editRevision}\n                                data-testid={\"fb.form-revisions.action-menu.edit\"}\n                            >\n                                <ListItemGraphic>\n                                    <Icon icon={<EditIcon />} />\n                                </ListItemGraphic>\n                                Edit\n                            </MenuItem>\n                        )}\n\n                        {rev.status !== \"published\" && canPublish() && (\n                            <MenuItem\n                                onClick={() => publishRevision(rev)}\n                                data-testid={\"fb.form-revisions.action-menu.publish\"}\n                            >\n                                <ListItemGraphic>\n                                    <Icon icon={<PublishIcon />} />\n                                </ListItemGraphic>\n                                Publish\n                            </MenuItem>\n                        )}\n\n                        {rev.status === \"published\" && canUnpublish() && (\n                            <ConfirmationDialog\n                                title=\"Confirmation required!\"\n                                message={\n                                    <span>Are you sure you want to unpublish this revision?</span>\n                                }\n                            >\n                                {({ showConfirmation }) => (\n                                    <MenuItem\n                                        onClick={() =>\n                                            showConfirmation(() => unpublishRevision(rev))\n                                        }\n                                        data-testid={\"fb.form-revisions.action-menu.unpublish\"}\n                                    >\n                                        <ListItemGraphic>\n                                            <Icon icon={<UnpublishIcon />} />\n                                        </ListItemGraphic>\n                                        Unpublish\n                                    </MenuItem>\n                                )}\n                            </ConfirmationDialog>\n                        )}\n\n                        <MenuDivider />\n\n                        {canDelete(form) && (\n                            <ConfirmationDialog\n                                title=\"Confirmation required!\"\n                                message={\n                                    <span>Are you sure you want to delete this revision?</span>\n                                }\n                            >\n                                {({ showConfirmation }) => (\n                                    <MenuItem\n                                        onClick={() => showConfirmation(deleteRevision)}\n                                        data-testid={\"fb.form-revisions.action-menu.delete\"}\n                                    >\n                                        <ListItemGraphic>\n                                            <Icon icon={<DeleteIcon />} />\n                                        </ListItemGraphic>\n                                        Delete\n                                    </MenuItem>\n                                )}\n                            </ConfirmationDialog>\n                        )}\n                    </Menu>\n                </ListItemMeta>\n            )}\n        </ListItem>\n    );\n};\n\nexport default Revision;\n"],"file":"Revision.js"}