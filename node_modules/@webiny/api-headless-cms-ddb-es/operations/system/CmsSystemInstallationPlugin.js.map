{"version":3,"sources":["../../../src/operations/system/CmsSystemInstallationPlugin.ts"],"names":["CmsSystemInstallationPlugin","InstallationPlugin","beforeInstall","context","elasticsearch","indices","putTemplate","name","body","index_patterns","settings","analysis","analyzer","lowercase_analyzer","type","filter","tokenizer","mappings","properties","property","fields","keyword","ignore_above","rawValues","enabled","err","console","log","WebinyError"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AAEA;AACA;AACA;AACA;AACO,MAAMA,2BAAN,SAA0CC,sCAA1C,CAA6D;AAAA;AAAA;AAAA,gDAClD,gCADkD;AAAA;;AAG7C,QAAbC,aAAa,CAAC;AAAEC,IAAAA;AAAF,GAAD,EAAc;AAC7B,UAAM;AAAEC,MAAAA;AAAF,QAAoBD,OAA1B;;AACA,QAAI;AACA,YAAMC,aAAa,CAACC,OAAd,CAAsBC,WAAtB,CAAkC;AACpCC,QAAAA,IAAI,EAAE,4BAD8B;AAEpCC,QAAAA,IAAI,EAAE;AACFC,UAAAA,cAAc,EAAE,CAAC,gBAAD,CADd;AAEFC,UAAAA,QAAQ,EAAE;AACNC,YAAAA,QAAQ,EAAE;AACNC,cAAAA,QAAQ,EAAE;AACNC,gBAAAA,kBAAkB,EAAE;AAChBC,kBAAAA,IAAI,EAAE,QADU;AAEhBC,kBAAAA,MAAM,EAAE,CAAC,WAAD,EAAc,MAAd,CAFQ;AAGhBC,kBAAAA,SAAS,EAAE;AAHK;AADd;AADJ;AADJ,WAFR;AAaFC,UAAAA,QAAQ,EAAE;AACNC,YAAAA,UAAU,EAAE;AACRC,cAAAA,QAAQ,EAAE;AACNL,gBAAAA,IAAI,EAAE,MADA;AAENM,gBAAAA,MAAM,EAAE;AACJC,kBAAAA,OAAO,EAAE;AACLP,oBAAAA,IAAI,EAAE,SADD;AAELQ,oBAAAA,YAAY,EAAE;AAFT;AADL,iBAFF;AAQNV,gBAAAA,QAAQ,EAAE;AARJ,eADF;AAWRW,cAAAA,SAAS,EAAE;AACPT,gBAAAA,IAAI,EAAE,QADC;AAEPU,gBAAAA,OAAO,EAAE;AAFF;AAXH;AADN;AAbR;AAF8B,OAAlC,CAAN;AAmCH,KApCD,CAoCE,OAAOC,GAAP,EAAY;AACVC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACA,YAAM,IAAIG,cAAJ,CACF,iCADE,EAEF,uCAFE,CAAN;AAIH;AACJ;;AAhD+D","sourcesContent":["import { InstallationPlugin } from \"@webiny/api-headless-cms/plugins/InstallationPlugin\";\nimport WebinyError from \"@webiny/error\";\n\n/**\n * We're creating a new plugin class and giving it a fixed name.\n * This will ensure that there's only 1 instance of this plugin registered at any given time.\n */\nexport class CmsSystemInstallationPlugin extends InstallationPlugin {\n    public name = \"cms.system.ddb-es-installation\";\n\n    async beforeInstall({ context }) {\n        const { elasticsearch } = context;\n        try {\n            await elasticsearch.indices.putTemplate({\n                name: \"headless-cms-entries-index\",\n                body: {\n                    index_patterns: [\"*headless-cms*\"],\n                    settings: {\n                        analysis: {\n                            analyzer: {\n                                lowercase_analyzer: {\n                                    type: \"custom\",\n                                    filter: [\"lowercase\", \"trim\"],\n                                    tokenizer: \"keyword\"\n                                }\n                            }\n                        }\n                    },\n                    mappings: {\n                        properties: {\n                            property: {\n                                type: \"text\",\n                                fields: {\n                                    keyword: {\n                                        type: \"keyword\",\n                                        ignore_above: 256\n                                    }\n                                },\n                                analyzer: \"lowercase_analyzer\"\n                            },\n                            rawValues: {\n                                type: \"object\",\n                                enabled: false\n                            }\n                        }\n                    }\n                }\n            });\n        } catch (err) {\n            console.log(err);\n            throw new WebinyError(\n                \"Index template creation failed!\",\n                \"CMS_INSTALLATION_INDEX_TEMPLATE_ERROR\"\n            );\n        }\n    }\n}\n"],"file":"CmsSystemInstallationPlugin.js"}