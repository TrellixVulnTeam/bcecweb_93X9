"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _apiSecurity = require("@webiny/api-security");

var _hasRwd = _interopRequireDefault(require("./hasRwd"));

var _default = async (context, name, check) => {
  await context.i18nContent.checkI18NContentPermission();
  const pbPagePermission = await context.security.getPermission(name);

  if (!pbPagePermission) {
    throw new _apiSecurity.NotAuthorizedError();
  }

  if (check.rwd && !(0, _hasRwd.default)(pbPagePermission, check.rwd)) {
    throw new _apiSecurity.NotAuthorizedError();
  }

  if (check.pw && !hasPw(pbPagePermission, check.pw)) {
    throw new _apiSecurity.NotAuthorizedError();
  }

  return pbPagePermission;
}; // Has publishing workflow permissions?


exports.default = _default;

const hasPw = (permission, pw) => {
  const isCustom = Object.keys(permission).length > 1; // "name" key is always present

  if (!isCustom) {
    // Means it's a "full-access" permission.
    return true;
  }

  if (typeof permission["pw"] !== "string") {
    return false;
  }

  return permission["pw"].includes(pw);
};
//# sourceMappingURL=checkBasePermissions.js.map