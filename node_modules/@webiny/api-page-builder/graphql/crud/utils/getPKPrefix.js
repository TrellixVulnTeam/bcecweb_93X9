"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _error = _interopRequireDefault(require("@webiny/error"));

var _default = (context, options = {}) => {
  let prefix = "PB#";

  if (options.locale !== false) {
    let locale = options.locale;

    if (locale !== "string") {
      var _i18nContent$getLocal;

      const {
        i18nContent
      } = context;
      locale = (_i18nContent$getLocal = i18nContent.getLocale()) === null || _i18nContent$getLocal === void 0 ? void 0 : _i18nContent$getLocal.code;
    }

    if (!locale) {
      throw new _error.default(`Cannot construct primary key - locale missing.`, "PB_CANNOT_CONSTRUCT_PK");
    }

    prefix = `L#${locale}#${prefix}`;
  }

  if (options.tenant !== false) {
    let tenant = options.tenant;

    if (tenant !== "string") {
      var _tenancy$getCurrentTe;

      const {
        tenancy
      } = context;
      tenant = (_tenancy$getCurrentTe = tenancy.getCurrentTenant()) === null || _tenancy$getCurrentTe === void 0 ? void 0 : _tenancy$getCurrentTe.id;
    }

    if (!tenant) {
      throw new _error.default(`Cannot construct primary key - tenant missing.`, "PB_CANNOT_CONSTRUCT_PK");
    }

    prefix = `T#${tenant}#${prefix}`;
  }

  return prefix;
};

exports.default = _default;
//# sourceMappingURL=getPKPrefix.js.map