{"version":3,"sources":["../../../src/admin/plugins/installation.tsx"],"names":["React","useState","useEffect","lazy","gql","useApolloClient","i18n","Alert","CircularProgress","SimpleForm","SimpleFormContent","styled","SimpleFormPlaceholder","minHeight","minWidth","t","ns","IS_INSTALLED","INSTALL","FMInstaller","onInstalled","client","error","setError","mutate","mutation","variables","srcPrefix","process","env","REACT_APP_API_URL","then","data","fileManager","install","message","setTimeout","label","plugin","name","type","title","dependencies","secure","getInstalledVersion","query","version","render","upgrades","getComponent"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, lazy } from \"react\";\nimport gql from \"graphql-tag\";\nimport { useApolloClient } from \"@apollo/react-hooks\";\nimport { i18n } from \"@webiny/app/i18n\";\nimport { AdminInstallationPlugin } from \"@webiny/app-admin/types\";\nimport { Alert } from \"@webiny/ui/Alert\";\nimport { CircularProgress } from \"@webiny/ui/Progress\";\nimport { SimpleForm, SimpleFormContent } from \"@webiny/app-admin/components/SimpleForm\";\nimport styled from \"@emotion/styled\";\n\nconst SimpleFormPlaceholder = styled.div({\n    minHeight: 300,\n    minWidth: 400\n});\n\nconst t = i18n.ns(\"app-file-manager/admin/installation\");\n\nconst IS_INSTALLED = gql`\n    query IsFileManagerInstalled {\n        fileManager {\n            version\n        }\n    }\n`;\n\nconst INSTALL = gql`\n    mutation InstallFileManager($srcPrefix: String) {\n        fileManager {\n            install(srcPrefix: $srcPrefix) {\n                data\n                error {\n                    code\n                    message\n                }\n            }\n        }\n    }\n`;\n\nconst FMInstaller = ({ onInstalled }) => {\n    const client = useApolloClient();\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        client\n            .mutate({\n                mutation: INSTALL,\n                variables: { srcPrefix: process.env.REACT_APP_API_URL + \"/files\" }\n            })\n            .then(({ data }) => {\n                const { error } = data.fileManager.install;\n                if (error) {\n                    setError(error.message);\n                    return;\n                }\n\n                // Just so the user sees the actual message.\n                setTimeout(onInstalled, 3000);\n            });\n    }, []);\n\n    const label = error ? (\n        <Alert title={t`Something went wrong`} type={\"danger\"}>\n            {error}\n        </Alert>\n    ) : (\n        t`Installing File Manager...`\n    );\n\n    return (\n        <SimpleForm>\n            <CircularProgress label={label} />\n            <SimpleFormContent>\n                <SimpleFormPlaceholder />\n            </SimpleFormContent>\n        </SimpleForm>\n    );\n};\n\nconst plugin: AdminInstallationPlugin = {\n    name: \"admin-installation-fm\",\n    type: \"admin-installation\",\n    title: t`File Manager`,\n    dependencies: [\"admin-installation-security\", \"admin-installation-i18n\"],\n    secure: true,\n    async getInstalledVersion({ client }) {\n        const { data } = await client.query({ query: IS_INSTALLED });\n        return data.fileManager.version;\n    },\n    render({ onInstalled }) {\n        return <FMInstaller onInstalled={onInstalled} />;\n    },\n    upgrades: [\n        {\n            version: \"5.0.0\",\n            getComponent() {\n                return lazy(() => import(\"./upgrades/v5.0.0\"));\n            }\n        }\n    ]\n};\n\nexport default plugin;\n"],"file":"installation.js"}