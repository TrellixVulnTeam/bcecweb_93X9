{"version":3,"sources":["../../../../src/admin/plugins/permissionRenderer/FileManagerPermissions.tsx"],"names":["React","Fragment","useCallback","useMemo","Grid","Cell","Select","i18n","PermissionInfo","gridNoPaddingClass","Form","Elevation","Typography","t","ns","FILE_MANAGER","FILE_MANAGER_FULL_ACCESS","FILE_MANAGER_ACCESS_FILE","FILE_MANAGER_ACCESS_SETTINGS","FULL_ACCESS","NO_ACCESS","CUSTOM_ACCESS","FileManagerPermissions","value","onChange","onFormChange","data","newValue","Array","isArray","filter","item","name","startsWith","accessLevel","push","filesAccessScope","permission","own","rwd","undefined","filesRWD","settingsAccessScope","formData","hasFullAccess","find","permissions","length","filesPermission","hasSettingsAccess","Bind","setValue","marginTop","padding","paddingBottom","cb"],"mappings":"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","sourcesContent":["import React, { Fragment, useCallback, useMemo } from \"react\";\nimport { Grid, Cell } from \"@webiny/ui/Grid\";\nimport { Select } from \"@webiny/ui/Select\";\nimport { i18n } from \"@webiny/app/i18n\";\nimport { PermissionInfo, gridNoPaddingClass } from \"@webiny/app-admin/components/Permissions\";\nimport { Form } from \"@webiny/form\";\nimport { Elevation } from \"@webiny/ui/Elevation\";\nimport { Typography } from \"@webiny/ui/Typography\";\n\nconst t = i18n.ns(\"app-file-manager/admin/plugins/permissionRenderer\");\n\nconst FILE_MANAGER = \"fm\";\nconst FILE_MANAGER_FULL_ACCESS = `${FILE_MANAGER}.*`;\nconst FILE_MANAGER_ACCESS_FILE = `${FILE_MANAGER}.file`;\nconst FILE_MANAGER_ACCESS_SETTINGS = `${FILE_MANAGER}.settings`;\n\nconst FULL_ACCESS = \"full\";\nconst NO_ACCESS = \"no\";\nconst CUSTOM_ACCESS = \"custom\";\n\nexport const FileManagerPermissions = ({ value, onChange }) => {\n    const onFormChange = useCallback(\n        data => {\n            let newValue = [];\n            if (Array.isArray(value)) {\n                // Let's just filter out the `file-manager*` permission objects, it's easier to build new ones from scratch.\n                newValue = value.filter(item => !item.name.startsWith(FILE_MANAGER));\n            }\n\n            if (data.accessLevel === NO_ACCESS) {\n                onChange(newValue);\n                return;\n            }\n\n            if (data.accessLevel === FULL_ACCESS) {\n                newValue.push({ name: FILE_MANAGER_FULL_ACCESS });\n                onChange(newValue);\n                return;\n            }\n\n            // Handling custom access level.\n\n            // Files first.\n            if (data.filesAccessScope && data.filesAccessScope !== NO_ACCESS) {\n                const permission = {\n                    name: FILE_MANAGER_ACCESS_FILE,\n                    own: false,\n                    rwd: undefined\n                };\n\n                if (data.filesAccessScope === \"own\") {\n                    permission.own = true;\n                    permission.rwd = \"rwd\";\n                } else {\n                    permission.rwd = data.filesRWD || \"r\";\n                }\n                newValue.push(permission);\n            }\n\n            // Settings second.\n            if (data.settingsAccessScope === FULL_ACCESS) {\n                newValue.push({ name: FILE_MANAGER_ACCESS_SETTINGS });\n            }\n\n            onChange(newValue);\n        },\n        [value]\n    );\n\n    const formData = useMemo(() => {\n        if (!Array.isArray(value)) {\n            return { accessLevel: NO_ACCESS };\n        }\n\n        const hasFullAccess = value.find(\n            item => item.name === FILE_MANAGER_FULL_ACCESS || item.name === \"*\"\n        );\n        if (hasFullAccess) {\n            return { accessLevel: FULL_ACCESS };\n        }\n\n        const permissions = value.filter(item => item.name.startsWith(FILE_MANAGER));\n        if (!permissions.length) {\n            return { accessLevel: NO_ACCESS };\n        }\n\n        const data = {\n            accessLevel: CUSTOM_ACCESS,\n            filesAccessScope: NO_ACCESS,\n            settingsAccessScope: NO_ACCESS,\n            filesRWD: \"r\"\n        };\n\n        const filesPermission = permissions.find(item => item.name === FILE_MANAGER_ACCESS_FILE);\n        if (filesPermission) {\n            data.filesAccessScope = filesPermission.own ? \"own\" : FULL_ACCESS;\n            if (data.filesAccessScope === FULL_ACCESS) {\n                data.filesRWD = filesPermission.rwd;\n            } else {\n                data.filesRWD = \"rwd\";\n            }\n        }\n\n        const hasSettingsAccess = permissions.find(\n            item => item.name === FILE_MANAGER_ACCESS_SETTINGS\n        );\n        if (hasSettingsAccess) {\n            data.settingsAccessScope = FULL_ACCESS;\n        }\n\n        return data;\n    }, []);\n\n    return (\n        <Form data={formData} onChange={onFormChange}>\n            {({ data, Bind, setValue }) => (\n                <Fragment>\n                    <Grid className={gridNoPaddingClass}>\n                        <Cell span={6}>\n                            <PermissionInfo title={t`Access Level`} />\n                        </Cell>\n                        <Cell span={6}>\n                            <Bind name={\"accessLevel\"}>\n                                <Select label={t`Access Level`}>\n                                    <option value={NO_ACCESS}>{t`No access`}</option>\n                                    <option value={FULL_ACCESS}>{t`Full access`}</option>\n                                    <option value={CUSTOM_ACCESS}>{t`Custom access`}</option>\n                                </Select>\n                            </Bind>\n                        </Cell>\n                    </Grid>\n                    {data.accessLevel === \"custom\" && (\n                        <Fragment>\n                            <Elevation z={1} style={{ marginTop: 10 }}>\n                                <Grid>\n                                    <Cell span={12}>\n                                        <Typography use={\"overline\"}>{t`Files`}</Typography>\n                                    </Cell>\n                                    <Cell span={12}>\n                                        <Grid style={{ padding: 0, paddingBottom: 24 }}>\n                                            <Cell span={12}>\n                                                <Bind\n                                                    name={\"filesAccessScope\"}\n                                                    beforeChange={(value, cb) => {\n                                                        if (value === \"own\") {\n                                                            setValue(`filesRWD`, \"rwd\");\n                                                        }\n                                                        cb(value);\n                                                    }}\n                                                >\n                                                    <Select label={t`Access Scope`}>\n                                                        <option\n                                                            value={NO_ACCESS}\n                                                        >{t`No access`}</option>\n                                                        <option\n                                                            value={FULL_ACCESS}\n                                                        >{t`All files`}</option>\n                                                        <option\n                                                            value={\"own\"}\n                                                        >{t`Only files created by the user`}</option>\n                                                    </Select>\n                                                </Bind>\n                                            </Cell>\n                                            <Cell span={12}>\n                                                <Bind name={\"filesRWD\"}>\n                                                    <Select\n                                                        label={t`Primary Actions`}\n                                                        disabled={data.filesAccessScope !== \"full\"}\n                                                    >\n                                                        <option value={\"r\"}>{t`Read`}</option>\n                                                        <option\n                                                            value={\"rw\"}\n                                                        >{t`Read, write`}</option>\n                                                        <option\n                                                            value={\"rwd\"}\n                                                        >{t`Read, write, delete`}</option>\n                                                    </Select>\n                                                </Bind>\n                                            </Cell>\n                                        </Grid>\n                                    </Cell>\n                                </Grid>\n                            </Elevation>\n                            <Elevation z={1} style={{ marginTop: 10 }}>\n                                <Grid>\n                                    <Cell span={12}>\n                                        <Typography use={\"overline\"}>{t`Settings`}</Typography>\n                                    </Cell>\n                                    <Cell span={12}>\n                                        <Bind name={\"settingsAccessScope\"}>\n                                            <Select label={t`Access Scope`}>\n                                                <option value={NO_ACCESS}>{t`No access`}</option>\n                                                <option\n                                                    value={FULL_ACCESS}\n                                                >{t`Full access`}</option>\n                                            </Select>\n                                        </Bind>\n                                    </Cell>\n                                </Grid>\n                            </Elevation>\n                        </Fragment>\n                    )}\n                </Fragment>\n            )}\n        </Form>\n    );\n};\n"],"file":"FileManagerPermissions.js"}