{"version":3,"sources":["../../../../../src/admin/plugins/permissionRenderer/components/ContentModelPermission.tsx"],"names":["React","useCallback","useEffect","get","Grid","Cell","Typography","Select","i18n","Elevation","PermissionSelector","PermissionSelectorWrapper","useCmsData","Note","ContentModelList","t","ns","ContentModelPermission","Bind","data","setValue","form","entity","title","locales","selectedContentModelGroups","modelsGroups","endpoints","length","onChangeFns","getItems","code","list","groups","filter","item","includes","group","id","disabledPrimaryActions","undefined","marginTop","padding","paddingBottom"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from \"react\";\nimport get from \"lodash/get\";\nimport { Grid, Cell } from \"@webiny/ui/Grid\";\nimport { Typography } from \"@webiny/ui/Typography\";\nimport { Select } from \"@webiny/ui/Select\";\nimport { i18n } from \"@webiny/app/i18n\";\nimport { Elevation } from \"@webiny/ui/Elevation\";\nimport { PermissionSelector, PermissionSelectorWrapper } from \"./PermissionSelector\";\nimport { useCmsData } from \"./useCmsData\";\nimport { Note } from \"./StyledComponents\";\nimport ContentModelList from \"./ContentModelList\";\n\nconst t = i18n.ns(\"app-headless-cms/admin/plugins/permissionRenderer\");\n\nexport const ContentModelPermission = ({\n    Bind,\n    data,\n    setValue,\n    form,\n    entity,\n    title,\n    locales,\n    selectedContentModelGroups\n}) => {\n    const modelsGroups = useCmsData(locales);\n    // Set \"cms.contentModel\" access scope to \"own\" if \"cms.contentModelGroup\" === \"own\".\n    useEffect(() => {\n        if (\n            get(data, `contentModelGroupAccessScope`) === \"own\" &&\n            get(data, `${entity}AccessScope`) !== \"own\"\n        ) {\n            setValue(`${entity}AccessScope`, \"own\");\n        }\n    }, [data]);\n\n    useEffect(() => {\n        // Let's set default values for \"accessScopes\"\n        if (\n            data.endpoints.length > 0 &&\n            !data[`${entity}AccessScope`] &&\n            form.onChangeFns[`${entity}AccessScope`]\n        ) {\n            setValue(`${entity}AccessScope`, \"full\");\n        }\n    }, [data, form]);\n\n    const getItems = useCallback(\n        (code: string) => {\n            let list = get(modelsGroups, `${code}.models`, []);\n\n            const groups = (selectedContentModelGroups && selectedContentModelGroups[code]) || [];\n            if (groups.length) {\n                // Filter by groups\n                list = list.filter(item => groups.includes(item.group.id));\n            }\n\n            return list;\n        },\n        [modelsGroups]\n    );\n\n    const disabledPrimaryActions =\n        [undefined, \"own\", \"no\"].includes(data[`${entity}AccessScope`]) ||\n        !data.endpoints.includes(\"manage\");\n\n    return (\n        <Elevation z={1} style={{ marginTop: 10 }}>\n            <Grid>\n                <Cell span={12}>\n                    <Typography use={\"overline\"}>{title}</Typography>\n                </Cell>\n                <Cell span={12}>\n                    <Grid style={{ padding: 0, paddingBottom: 24 }}>\n                        <Cell span={12}>\n                            <Bind name={`${entity}AccessScope`}>\n                                <Select\n                                    label={t`Access Scope`}\n                                    disabled={data[`contentModelGroupAccessScope`] === \"own\"}\n                                    description={t`The list of available models is defined by the options set in the content model groups section above.`}\n                                >\n                                    <option value={\"full\"}>{t`All models`}</option>\n                                    <option value={\"models\"}>{t`Only specific models`}</option>\n                                    {data.endpoints.includes(\"manage\") && (\n                                        <option\n                                            value={\"own\"}\n                                        >{t`Only models created by the user`}</option>\n                                    )}\n                                </Select>\n                            </Bind>\n                            {data[`contentModelGroupAccessScope`] === \"own\" && (\n                                <Note>\n                                    <Typography use={\"caption\"}>\n                                        <span className={\"highlight\"}>Content Model</span>\n                                        &nbsp;{t`access depends upon`}&nbsp;\n                                        <span className={\"highlight\"}>Content Model Group</span>\n                                    </Typography>\n                                </Note>\n                            )}\n                        </Cell>\n                        {data[`${entity}AccessScope`] === \"models\" && (\n                            <PermissionSelectorWrapper>\n                                <PermissionSelector\n                                    locales={locales}\n                                    Bind={Bind}\n                                    entity={entity}\n                                    selectorKey={\"models\"}\n                                    getItems={getItems}\n                                    RenderItems={ContentModelList}\n                                />\n                            </PermissionSelectorWrapper>\n                        )}\n\n                        <Cell span={12}>\n                            <Bind name={`${entity}RWD`}>\n                                <Select\n                                    label={t`Primary Actions`}\n                                    disabled={disabledPrimaryActions}\n                                >\n                                    <option value={\"r\"}>{t`Read`}</option>\n                                    {data.endpoints.includes(\"manage\") ? (\n                                        <option value={\"rw\"}>{t`Read, write`}</option>\n                                    ) : null}\n                                    {data.endpoints.includes(\"manage\") ? (\n                                        <option value={\"rwd\"}>{t`Read, write, delete`}</option>\n                                    ) : null}\n                                </Select>\n                            </Bind>\n                        </Cell>\n                    </Grid>\n                </Cell>\n            </Grid>\n        </Elevation>\n    );\n};\n"],"file":"ContentModelPermission.js"}