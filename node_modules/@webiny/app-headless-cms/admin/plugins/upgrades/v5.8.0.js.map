{"version":3,"sources":["../../../../src/admin/plugins/upgrades/v5.8.0.tsx"],"names":["React","useCallback","useState","gql","i18n","SimpleForm","SimpleFormContent","SimpleFormFooter","SimpleFormHeader","useApolloClient","Alert","CircularProgress","Cell","Grid","ButtonPrimary","Typography","t","ns","UPGRADE","Upgrade","onInstalled","client","error","setError","loading","setLoading","startUpgrade","mutate","mutation","variables","version","then","data","cms","upgrade","message","label"],"mappings":";;;;;;;AAAA,OAAOA,KAAP,IAAgBC,WAAhB,EAA6BC,QAA7B,QAA6C,OAA7C;AACA,OAAOC,GAAP,MAAgB,aAAhB;AACA,SAASC,IAAT,QAAqB,kBAArB;AACA,SACIC,UADJ,EAEIC,iBAFJ,EAGIC,gBAHJ,EAIIC,gBAJJ,QAKO,yCALP;AAMA,SAASC,eAAT,QAAgC,qBAAhC;AACA,SAASC,KAAT,QAAsB,kBAAtB;AACA,SAASC,gBAAT,QAAiC,qBAAjC;AACA,SAASC,IAAT,EAAeC,IAAf,QAA2B,iBAA3B;AACA,SAASC,aAAT,QAA8B,mBAA9B;AACA,SAASC,UAAT,QAA2B,uBAA3B;AAEA,IAAMC,CAAC,GAAGZ,IAAI,CAACa,EAAL,CAAQ,qCAAR,CAAV;AAEA,IAAMC,OAAO,GAAGf,GAAH,kWAAb;;AAeA,IAAMgB,OAAO,GAAG,SAAVA,OAAU,OAAqB;AAAA,MAAlBC,WAAkB,QAAlBA,WAAkB;AACjC,MAAMC,MAAM,GAAGZ,eAAe,EAA9B;;AACA,kBAA0BP,QAAQ,CAAC,IAAD,CAAlC;AAAA;AAAA,MAAOoB,KAAP;AAAA,MAAcC,QAAd;;AACA,mBAA8BrB,QAAQ,CAAC,KAAD,CAAtC;AAAA;AAAA,MAAOsB,OAAP;AAAA,MAAgBC,UAAhB;;AAEA,MAAMC,YAAY,GAAGzB,WAAW,wEAAC;AAAA;AAAA;AAAA;AAAA;AAC7BwB,YAAAA,UAAU,CAAC,IAAD,CAAV;AAD6B;AAAA,mBAEvBJ,MAAM,CACPM,MADC,CACM;AACJC,cAAAA,QAAQ,EAAEV,OADN;AAEJW,cAAAA,SAAS,EAAE;AACPC,gBAAAA,OAAO,EAAE;AADF;AAFP,aADN,EAODC,IAPC,CAOI,iBAAc;AAAA,kBAAXC,IAAW,SAAXA,IAAW;AAChBP,cAAAA,UAAU,CAAC,KAAD,CAAV;AACA,kBAAQH,KAAR,GAAkBU,IAAI,CAACC,GAAL,CAASC,OAA3B,CAAQZ,KAAR;;AACA,kBAAIA,KAAJ,EAAW;AACPC,gBAAAA,QAAQ,CAACD,KAAK,CAACa,OAAP,CAAR;AACA;AACH;;AAEDf,cAAAA,WAAW;AACd,aAhBC,CAFuB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,IAmB7B,EAnB6B,CAAhC;AAqBA,MAAMgB,KAAK,GAAGd,KAAK,gBACf,oBAAC,KAAD;AAAO,IAAA,KAAK,EAAEN,CAAF,2FAAZ;AAAuC,IAAA,IAAI,EAAE;AAA7C,KACKM,KADL,CADe,GAKfN,CALe,gGAAnB;AAQA,sBACI,oBAAC,UAAD,QACKQ,OAAO,iBAAI,oBAAC,gBAAD;AAAkB,IAAA,KAAK,EAAEY;AAAzB,IADhB,eAEI,oBAAC,gBAAD;AAAkB,IAAA,KAAK,EAAE;AAAzB,IAFJ,eAGI,oBAAC,iBAAD,qBACI,oBAAC,IAAD,qBACI,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAE;AAAZ,kBACI,oBAAC,UAAD;AAAY,IAAA,GAAG,EAAE,OAAjB;AAA0B,IAAA,GAAG,EAAE;AAA/B,yDAEI,6CACI,yDACY,6CADZ,wBACwC,8CADxC,8DADJ,CAFJ,CADJ,CADJ,CADJ,CAHJ,eAkBI,oBAAC,gBAAD,qBACI,oBAAC,aAAD;AAAe,IAAA,OAAO,EAAEV;AAAxB,eADJ,CAlBJ,CADJ;AAwBH,CA1DD;;AA4DA,eAAeP,OAAf","sourcesContent":["import React, { useCallback, useState } from \"react\";\nimport gql from \"graphql-tag\";\nimport { i18n } from \"@webiny/app/i18n\";\nimport {\n    SimpleForm,\n    SimpleFormContent,\n    SimpleFormFooter,\n    SimpleFormHeader\n} from \"@webiny/app-admin/components/SimpleForm\";\nimport { useApolloClient } from \"@apollo/react-hooks\";\nimport { Alert } from \"@webiny/ui/Alert\";\nimport { CircularProgress } from \"@webiny/ui/Progress\";\nimport { Cell, Grid } from \"@webiny/ui/Grid\";\nimport { ButtonPrimary } from \"@webiny/ui/Button\";\nimport { Typography } from \"@webiny/ui/Typography\";\n\nconst t = i18n.ns(\"app-headless-cms/admin/installation\");\n\nconst UPGRADE = gql`\n    mutation UpgradeCMS($version: String!) {\n        cms {\n            upgrade(version: $version) {\n                data\n                error {\n                    code\n                    message\n                    data\n                }\n            }\n        }\n    }\n`;\n\nconst Upgrade = ({ onInstalled }) => {\n    const client = useApolloClient();\n    const [error, setError] = useState(null);\n    const [loading, setLoading] = useState(false);\n\n    const startUpgrade = useCallback(async () => {\n        setLoading(true);\n        await client\n            .mutate({\n                mutation: UPGRADE,\n                variables: {\n                    version: \"5.8.0\"\n                }\n            })\n            .then(({ data }) => {\n                setLoading(false);\n                const { error } = data.cms.upgrade;\n                if (error) {\n                    setError(error.message);\n                    return;\n                }\n\n                onInstalled();\n            });\n    }, []);\n\n    const label = error ? (\n        <Alert title={t`Something went wrong`} type={\"danger\"}>\n            {error}\n        </Alert>\n    ) : (\n        t`Upgrading Headless CMS...`\n    );\n\n    return (\n        <SimpleForm>\n            {loading && <CircularProgress label={label} />}\n            <SimpleFormHeader title={\"Upgrade Headless CMS\"} />\n            <SimpleFormContent>\n                <Grid>\n                    <Cell span={12}>\n                        <Typography use={\"body1\"} tag={\"div\"}>\n                            This upgrade will do the following:\n                            <ul>\n                                <li>\n                                    add the <strong>tenant</strong> and <strong>entryId</strong> to\n                                    all of the records in the DynamoDB and Elasticsearch.\n                                </li>\n                            </ul>\n                        </Typography>\n                    </Cell>\n                </Grid>\n            </SimpleFormContent>\n            <SimpleFormFooter>\n                <ButtonPrimary onClick={startUpgrade}>Upgrade</ButtonPrimary>\n            </SimpleFormFooter>\n        </SimpleForm>\n    );\n};\n\nexport default Upgrade;\n"],"file":"v5.8.0.js"}