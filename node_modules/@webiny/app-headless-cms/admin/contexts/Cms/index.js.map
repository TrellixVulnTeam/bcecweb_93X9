{"version":3,"sources":["../../../../src/admin/contexts/Cms/index.tsx"],"names":["React","useI18N","CircularProgress","CmsContext","createContext","apolloClientsCache","CmsProvider","props","getCurrentLocale","currentLocale","createApolloClient","uri","process","env","REACT_APP_API_URL","value","getApolloClient","locale","apolloClient"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,SAASC,OAAT,QAAwB,gCAAxB;AACA,SAASC,gBAAT,QAAiC,qBAAjC;AAQA,OAAO,IAAMC,UAAU,gBAAGH,KAAK,CAACI,aAAN,CAAqC,IAArC,CAAnB;AAEP,IAAMC,kBAAkB,GAAG,EAA3B;AAOA,OAAO,SAASC,WAAT,CAAqBC,KAArB,EAA8C;AACjD,iBAA6BN,OAAO,EAApC;AAAA,MAAQO,gBAAR,YAAQA,gBAAR;;AAEA,MAAMC,aAAa,GAAGD,gBAAgB,CAAC,SAAD,CAAtC,CAHiD,CAKjD;AACA;AACA;AACA;AACA;;AAEA,MAAIC,aAAa,IAAI,CAACJ,kBAAkB,CAACI,aAAD,CAAxC,EAAyD;AACrDJ,IAAAA,kBAAkB,CAACI,aAAD,CAAlB,GAAoCF,KAAK,CAACG,kBAAN,CAAyB;AACzDC,MAAAA,GAAG,YAAKC,OAAO,CAACC,GAAR,CAAYC,iBAAjB,yBAAiDL,aAAjD;AADsD,KAAzB,CAApC;AAGH;;AAED,MAAMM,KAAK,GAAG;AACVC,IAAAA,eADU,2BACMC,MADN,EACsB;AAC5B,UAAI,CAACZ,kBAAkB,CAACY,MAAD,CAAvB,EAAiC;AAC7BZ,QAAAA,kBAAkB,CAACY,MAAD,CAAlB,GAA6BV,KAAK,CAACG,kBAAN,CAAyB;AAClDC,UAAAA,GAAG,YAAKC,OAAO,CAACC,GAAR,CAAYC,iBAAjB,yBAAiDG,MAAjD;AAD+C,SAAzB,CAA7B;AAGH;;AACD,aAAOZ,kBAAkB,CAACY,MAAD,CAAzB;AACH,KARS;AASVP,IAAAA,kBAAkB,EAAEH,KAAK,CAACG,kBAThB;AAUVQ,IAAAA,YAAY,EAAEb,kBAAkB,CAACI,aAAD;AAVtB,GAAd;;AAaA,MAAI,CAACA,aAAL,EAAoB;AAChB,wBAAO,oBAAC,gBAAD,OAAP;AACH;;AAED,sBAAO,oBAAC,UAAD,CAAY,QAAZ;AAAqB,IAAA,KAAK,EAAEM;AAA5B,KAAuCR,KAAvC,EAAP;AACH","sourcesContent":["import React from \"react\";\nimport ApolloClient from \"apollo-client\";\nimport { useI18N } from \"@webiny/app-i18n/hooks/useI18N\";\nimport { CircularProgress } from \"@webiny/ui/Progress\";\n\nexport interface CmsContextValue {\n    getApolloClient(locale: string): ApolloClient<any>;\n    createApolloClient: CmsProviderProps[\"createApolloClient\"];\n    apolloClient: ApolloClient<any>;\n}\n\nexport const CmsContext = React.createContext<CmsContextValue>(null);\n\nconst apolloClientsCache = {};\n\ntype CmsProviderProps = {\n    createApolloClient: (params: { uri: string }) => ApolloClient<any>;\n    children: React.ReactNode;\n};\n\nexport function CmsProvider(props: CmsProviderProps) {\n    const { getCurrentLocale } = useI18N();\n\n    const currentLocale = getCurrentLocale(\"content\");\n\n    // TODO: not sure why this was necessary :thinking:\n    // const hasPermission = identity.getPermission(\"cms.endpoint.manage\");\n    // if (!hasPermission) {\n    //     return <CmsContext.Provider value={{}} {...props} />;\n    // }\n\n    if (currentLocale && !apolloClientsCache[currentLocale]) {\n        apolloClientsCache[currentLocale] = props.createApolloClient({\n            uri: `${process.env.REACT_APP_API_URL}/cms/manage/${currentLocale}`\n        });\n    }\n\n    const value = {\n        getApolloClient(locale: string) {\n            if (!apolloClientsCache[locale]) {\n                apolloClientsCache[locale] = props.createApolloClient({\n                    uri: `${process.env.REACT_APP_API_URL}/cms/manage/${locale}`\n                });\n            }\n            return apolloClientsCache[locale];\n        },\n        createApolloClient: props.createApolloClient,\n        apolloClient: apolloClientsCache[currentLocale]\n    };\n\n    if (!currentLocale) {\n        return <CircularProgress />;\n    }\n\n    return <CmsContext.Provider value={value} {...props} />;\n}\n"],"file":"index.js"}