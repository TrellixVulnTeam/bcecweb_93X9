{"version":3,"sources":["../../../src/ui/views/NavigationView.tsx"],"names":["React","Fragment","sortBy","nanoid","UIView","plugins","GenericElement","useSecurity","HeaderElement","ContentElement","FooterElement","useNavigation","NavigationMenuElement","TAGS","NavigationViewRenderer","ElementID","NavigationView","useGrid","addHookDefinition","elementConfig","closeMenu","getHook","hideMenu","addElement","Header","Content","Footer","addUtilityMenuElement","SettingsMenu","label","icon","setupLegacyMenuPlugins","addRenderer","applyPlugins","element","addTag","APP","getContentElement","UTILS","getSettingsMenuElement","getElement","menuPlugins","byType","legacyMenu","Menu","props","menuItem","addAppMenuElement","name","Children","map","children","child","isValidElement","cloneElement","parent","Section","sectionMenu","Item","path","p","order","forEach","plugin","render","setTimeout","remove"],"mappings":"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","sourcesContent":["import React, { Fragment } from \"react\";\nimport sortBy from \"lodash/sortBy\";\nimport { nanoid } from \"nanoid\";\nimport { UIView } from \"~/ui/UIView\";\nimport { plugins } from \"@webiny/plugins\";\nimport { GenericElement } from \"~/ui/elements/GenericElement\";\nimport { UseSecurity, useSecurity } from \"@webiny/app-security\";\nimport { HeaderElement } from \"./NavigationView/HeaderElement\";\nimport { ContentElement } from \"./NavigationView/ContentElement\";\nimport { FooterElement } from \"./NavigationView/FooterElement\";\nimport { useNavigation, UseNavigation } from \"~/ui/views/NavigationView/useNavigation\";\nimport { AdminMenuPlugin } from \"~/types\";\nimport { NavigationMenuElement, TAGS } from \"~/ui/elements/NavigationMenuElement\";\nimport { ItemProps, MenuProps, SectionProps } from \"./NavigationView/legacyMenu\";\nimport { ReactComponent as SettingsIcon } from \"~/assets/icons/round-settings-24px.svg\";\nimport { NavigationViewRenderer } from \"./NavigationView/NavigationViewRenderer\";\n\nexport enum ElementID {\n    Header = \"navigationHeader\",\n    Content = \"navigationContent\",\n    Footer = \"navigationFooter\",\n    SettingsMenu = \"menu.settings\"\n}\n\nexport class NavigationView extends UIView {\n    constructor() {\n        super(\"NavigationView\");\n\n        this.useGrid(false);\n        this.addHookDefinition(\"navigation\", useNavigation);\n        this.addHookDefinition(\"security\", useSecurity);\n\n        const elementConfig = {\n            closeMenu: () => this.getHook<UseNavigation>(\"navigation\").hideMenu()\n        };\n\n        this.addElement(new HeaderElement(ElementID.Header, elementConfig));\n        this.addElement(new ContentElement(ElementID.Content));\n        this.addElement(new FooterElement(ElementID.Footer, elementConfig));\n\n        this.addUtilityMenuElement(\n            new NavigationMenuElement(ElementID.SettingsMenu, {\n                label: \"Settings\",\n                icon: <SettingsIcon />\n            })\n        );\n\n        // Load legacy plugins and convert them into elements\n        this.setupLegacyMenuPlugins();\n\n        this.addRenderer(new NavigationViewRenderer());\n\n        this.applyPlugins(NavigationView);\n    }\n\n    addAppMenuElement(element: NavigationMenuElement) {\n        element.addTag(TAGS.APP);\n        return this.getContentElement().addElement(element);\n    }\n\n    addUtilityMenuElement(element: NavigationMenuElement) {\n        element.addTag(TAGS.UTILS);\n        return this.getContentElement().addElement(element);\n    }\n\n    addSettingsMenuElement(element: NavigationMenuElement) {\n        return this.getSettingsMenuElement().addElement(element);\n    }\n\n    getNavigationHook(): UseNavigation {\n        return this.getHook(\"navigation\");\n    }\n\n    getSecurityHook(): UseSecurity {\n        return this.getHook(\"security\");\n    }\n\n    getHeaderElement(): HeaderElement {\n        return this.getElement(ElementID.Header);\n    }\n\n    getContentElement(): ContentElement {\n        return this.getElement(ElementID.Content);\n    }\n\n    getFooterElement(): FooterElement {\n        return this.getElement(ElementID.Footer);\n    }\n\n    getSettingsMenuElement(): NavigationMenuElement {\n        return this.getElement(ElementID.SettingsMenu);\n    }\n\n    private setupLegacyMenuPlugins() {\n        // IMPORTANT! The following piece of code is for BACKWARDS COMPATIBILITY purposes only!\n        const menuPlugins = plugins.byType<AdminMenuPlugin>(\"admin-menu\");\n        if (!menuPlugins) {\n            return;\n        }\n\n        const legacyMenu = new GenericElement(\"legacy-menu\");\n\n        const Menu = (props: MenuProps) => {\n            const menuItem = this.addAppMenuElement(\n                new NavigationMenuElement(`navigation.content.${props.name}`, {\n                    label: props.label,\n                    icon: props.icon\n                })\n            );\n\n            return (\n                <Fragment>\n                    {React.Children.map(props.children, child => {\n                        if (!React.isValidElement(child)) {\n                            return child;\n                        }\n                        return React.cloneElement(child, { parent: menuItem });\n                    })}\n                </Fragment>\n            );\n        };\n\n        const Section = ({ parent, ...props }: SectionProps) => {\n            const sectionMenu = parent.addElement<NavigationMenuElement>(\n                new NavigationMenuElement(nanoid(), {\n                    label: props.label\n                })\n            );\n\n            return (\n                <Fragment>\n                    {React.Children.map(props.children, child => {\n                        if (!React.isValidElement(child)) {\n                            return child;\n                        }\n                        return React.cloneElement(child, { parent: sectionMenu });\n                    })}\n                </Fragment>\n            );\n        };\n\n        const Item = ({ parent, ...props }: ItemProps) => {\n            parent.addElement<NavigationMenuElement>(\n                new NavigationMenuElement(nanoid(), {\n                    label: props.label,\n                    path: props.path\n                })\n            );\n\n            return null;\n        };\n\n        sortBy(menuPlugins, [p => p.order || 50, p => p.name]).forEach(plugin => {\n            legacyMenu.addElement(\n                new GenericElement(plugin.name, () => plugin.render({ Menu, Section, Item }))\n            );\n        });\n\n        this.addElement(legacyMenu);\n\n        setTimeout(() => {\n            legacyMenu.remove();\n        }, 100);\n    }\n}\n"],"file":"NavigationView.js"}