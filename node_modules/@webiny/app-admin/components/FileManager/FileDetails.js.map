{"version":3,"sources":["../../../src/components/FileManager/FileDetails.tsx"],"names":["React","useCallback","useMemo","useState","bytes","classNames","css","Drawer","DrawerContent","IconButton","getFileTypePlugin","dayjs","get","set","cloneDeep","Tags","Name","Tooltip","Icon","Typography","useHotkeys","useFileManager","useMutation","useSnackbar","useSecurity","ConfirmationDialog","DELETE_FILE","LIST_FILES","LIST_TAGS","i18n","mime","t","ns","fileDetailsSidebar","width","style","wrapper","height","overflowY","header","textAlign","marginBottom","paddingTop","textTransform","color","fontWeight","preview","boxSizing","display","justifyContent","alignItems","position","margin","img","objectFit","maxHeight","maxWidth","transform","backgroundColor","download","list","li","padding","lineHeight","minHeight","marginRight","flex","whiteSpace","overflow","textOverflow","drawerContent","isImage","file","fileType","getType","name","includes","FileDetails","props","uploadFile","validateFiles","filePlugin","actions","hideFileDetails","queryParams","darkImageBackground","setDarkImageBackground","identity","fmFilePermission","getPermission","canDelete","item","own","login","rwd","zIndex","disabled","keys","esc","update","cache","data","readQuery","query","variables","filteredList","fileManager","listFiles","filter","id","selectedFile","find","writeQuery","Array","isArray","tags","tagCountMap","forEach","tag","listTagsData","filteredTags","listTags","deleteFile","showSnackbar","renderDeleteImageAction","fileDeleteConfirmationProps","title","message","showConfirmation","fileTypeIcon","type","Boolean","dark","render","navigator","clipboard","writeText","src","map","Component","index","format","size","unitSeparator","createdOn"],"mappings":"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","sourcesContent":["import React, { useCallback, useMemo, useState } from \"react\";\nimport bytes from \"bytes\";\nimport classNames from \"classnames\";\nimport { css } from \"emotion\";\nimport { Drawer, DrawerContent } from \"@webiny/ui/Drawer\";\nimport { IconButton } from \"@webiny/ui/Button\";\nimport getFileTypePlugin from \"./getFileTypePlugin\";\nimport dayjs from \"dayjs\";\nimport get from \"lodash/get\";\nimport set from \"lodash/set\";\nimport cloneDeep from \"lodash/cloneDeep\";\nimport Tags from \"./FileDetails/Tags\";\nimport Name from \"./FileDetails/Name\";\nimport { Tooltip } from \"@webiny/ui/Tooltip\";\nimport { Icon } from \"@webiny/ui/Icon\";\nimport { Typography } from \"@webiny/ui/Typography\";\nimport { useHotkeys } from \"react-hotkeyz\";\nimport { ReactComponent as CopyContentIcon } from \"./icons/content_copy-black-24px.svg\";\nimport { ReactComponent as DeleteIcon } from \"./icons/delete.svg\";\nimport { ReactComponent as ImageIcon } from \"../../assets/icons/insert_photo-24px.svg\";\nimport { ReactComponent as FileIcon } from \"../../assets/icons/insert_drive_file-24px.svg\";\nimport { ReactComponent as CalendarIcon } from \"../../assets/icons/today-24px.svg\";\nimport { ReactComponent as HighlightIcon } from \"../../assets/icons/highlight-24px.svg\";\nimport { useFileManager } from \"./FileManagerContext\";\nimport { useMutation } from \"@apollo/react-hooks\";\nimport { useSnackbar } from \"../../hooks/useSnackbar\";\nimport { useSecurity } from \"@webiny/app-security\";\nimport { ConfirmationDialog } from \"@webiny/ui/ConfirmationDialog\";\nimport { DELETE_FILE, LIST_FILES, LIST_TAGS } from \"./graphql\";\nimport { i18n } from \"@webiny/app/i18n\";\nimport mime from \"mime\";\n\nconst t = i18n.ns(\"app-admin/file-manager/file-details\");\n\nconst fileDetailsSidebar = css({\n    \"&.mdc-drawer\": {\n        width: 360\n    }\n});\n\ndeclare global {\n    // eslint-disable-next-line\n    namespace JSX {\n        interface IntrinsicElements {\n            \"li-title\": {\n                children?: React.ReactNode;\n            };\n\n            \"li-content\": {\n                children?: React.ReactNode;\n            };\n        }\n    }\n}\n\nconst style: any = {\n    wrapper: css({\n        height: \"100vh\",\n        overflowY: \"auto\"\n    }),\n    header: css({\n        textAlign: \"center\",\n        marginBottom: 24,\n        paddingTop: 16,\n        \"& span\": {\n            textTransform: \"capitalize\",\n            color: \"var(--mdc-theme-on-surface)\",\n            fontWeight: 600\n        }\n    }),\n    preview: css({\n        boxSizing: \"border-box\",\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        position: \"relative\",\n        width: \"100%\",\n        height: 300,\n        margin: \"0 auto 24px\",\n        img: {\n            objectFit: \"contain\",\n            maxHeight: 300,\n            maxWidth: 300,\n            width: \"100%\",\n            position: \"static\",\n            transform: \"none\"\n        },\n        \"&.dark\": {\n            backgroundColor: \"var(--mdc-theme-background)\"\n        }\n    }),\n    download: css({\n        textAlign: \"center\",\n        margin: \"0 auto\",\n        width: \"100%\",\n        \"& .icon--active\": {\n            \"&.mdc-icon-button\": {\n                color: \"var(--mdc-theme-text-on-primary)\"\n            }\n        }\n    }),\n    list: css({\n        textAlign: \"left\",\n        color: \"var(--mdc-theme-on-surface)\",\n        li: {\n            padding: \"12px 16px\",\n            lineHeight: \"22px\",\n            \"li-title\": {\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"flex-start\",\n                minHeight: 48,\n                \"& .list-item__title\": {\n                    fontWeight: 600\n                },\n                \"& .list-item__icon\": {\n                    marginRight: 24\n                },\n                \"& .list-item__content\": {\n                    flex: \"1 0 200px\"\n                }\n            },\n            \"li-content\": {\n                width: \"100%\",\n                display: \"block\",\n                \"& .list-item__truncate\": {\n                    display: \"block\",\n                    width: \"100%\",\n                    whiteSpace: \"nowrap\",\n                    overflow: \"hidden\",\n                    textOverflow: \"ellipsis\"\n                }\n            }\n        }\n    }),\n    drawerContent: css({\n        \"&.mdc-drawer__content\": {\n            height: \"auto\",\n            overflowY: \"inherit\"\n        }\n    })\n};\ntype FileDetailsProps = {\n    canEdit: (item: any) => boolean;\n    file: {\n        name: string;\n        [key: string]: any;\n    };\n    [key: string]: any;\n};\n\nconst isImage = file => {\n    const fileType = mime.getType(file && file.name);\n\n    if (fileType && typeof fileType === \"string\") {\n        return fileType.includes(\"image\");\n    }\n\n    return false;\n};\n\nexport default function FileDetails(props: FileDetailsProps) {\n    const { file, uploadFile, validateFiles } = props;\n\n    const filePlugin = getFileTypePlugin(file);\n    const actions = get(filePlugin, \"fileDetails.actions\") || get(filePlugin, \"actions\") || [];\n\n    const { hideFileDetails, queryParams } = useFileManager();\n    const [darkImageBackground, setDarkImageBackground] = useState(false);\n\n    const { identity } = useSecurity();\n    const fmFilePermission = useMemo(() => identity.getPermission(\"fm.file\"), []);\n    const canDelete = useCallback(\n        item => {\n            // Bail out early if no access\n            if (!fmFilePermission) {\n                return false;\n            }\n            if (fmFilePermission.own) {\n                return get(item, \"createdBy.id\") === identity.login;\n            }\n            if (typeof fmFilePermission.rwd === \"string\") {\n                return fmFilePermission.rwd.includes(\"d\");\n            }\n            return true;\n        },\n        [fmFilePermission]\n    );\n\n    useHotkeys({\n        zIndex: 55,\n        disabled: !file,\n        keys: {\n            esc: hideFileDetails\n        }\n    });\n\n    const [deleteFile] = useMutation(DELETE_FILE, {\n        update: cache => {\n            // 1. Update files list cache\n            const data: any = cloneDeep(\n                cache.readQuery({\n                    query: LIST_FILES,\n                    variables: queryParams\n                })\n            );\n            const filteredList = data.fileManager.listFiles.data.filter(\n                item => item.id !== file.id\n            );\n            const selectedFile = data.fileManager.listFiles.data.find(item => item.id === file.id);\n\n            cache.writeQuery({\n                query: LIST_FILES,\n                variables: queryParams,\n                data: set(data, \"fileManager.listFiles.data\", filteredList)\n            });\n            // 2. Update \"ListTags\" cache\n            if (Array.isArray(selectedFile.tags)) {\n                const tagCountMap = {};\n                // Prepare \"tag\" count map\n                data.fileManager.listFiles.data.forEach(file => {\n                    if (!Array.isArray(file.tags)) {\n                        return;\n                    }\n                    file.tags.forEach(tag => {\n                        if (tagCountMap[tag]) {\n                            tagCountMap[tag] += 1;\n                        } else {\n                            tagCountMap[tag] = 1;\n                        }\n                    });\n                });\n\n                // Get tags from cache\n                const listTagsData: any = cloneDeep(\n                    cache.readQuery({\n                        query: LIST_TAGS\n                    })\n                );\n                // Remove selected file tags from list.\n                const filteredTags = listTagsData.fileManager.listTags.filter(tag => {\n                    if (!selectedFile.tags.includes(tag)) {\n                        return true;\n                    }\n                    return tagCountMap[tag] > 1;\n                });\n\n                // Write it to cache\n                cache.writeQuery({\n                    query: LIST_TAGS,\n                    data: set(data, \"fileManager.listTags\", filteredTags)\n                });\n            }\n        }\n    });\n    const { showSnackbar } = useSnackbar();\n\n    const renderDeleteImageAction = useCallback(file => {\n        if (!canDelete(file)) {\n            return null;\n        }\n        const fileDeleteConfirmationProps = {\n            title: t`Delete file`,\n            message: file && (\n                <span>\n                    {t`You're about to delete file {name}. Are you sure you want to continue?`({\n                        name: file.name\n                    })}\n                </span>\n            )\n        };\n        return (\n            <ConfirmationDialog\n                {...fileDeleteConfirmationProps}\n                data-testid={\"fm-delete-file-confirmation-dialog\"}\n                style={{ zIndex: 100 }}\n            >\n                {({ showConfirmation }) => {\n                    return (\n                        <Tooltip\n                            content={\n                                isImage ? (\n                                    <span>{t`Delete image`}</span>\n                                ) : (\n                                    <span>{t`Delete file`}</span>\n                                )\n                            }\n                            placement={\"bottom\"}\n                        >\n                            <IconButton\n                                data-testid={\"fm-delete-file-button\"}\n                                icon={<DeleteIcon style={{ margin: \"0 8px 0 0\" }} />}\n                                onClick={() =>\n                                    showConfirmation(async () => {\n                                        await deleteFile({\n                                            variables: {\n                                                id: file.id\n                                            }\n                                        });\n                                        showSnackbar(t`File deleted successfully.`);\n                                    })\n                                }\n                            />\n                        </Tooltip>\n                    );\n                }}\n            </ConfirmationDialog>\n        );\n    }, []);\n\n    const fileTypeIcon = useMemo(() => {\n        if (file && typeof file.type === \"string\") {\n            return file.type.includes(\"image\") ? <ImageIcon /> : <FileIcon />;\n        }\n        return <ImageIcon />;\n    }, [file]);\n\n    return (\n        <Drawer\n            className={fileDetailsSidebar}\n            dir=\"rtl\"\n            modal\n            open={Boolean(file)}\n            onClose={hideFileDetails}\n            data-testid={\"fm.file-details.drawer\"}\n        >\n            {file && (\n                <div className={style.wrapper} dir=\"ltr\">\n                    <div className={style.header}>\n                        <Typography use={\"headline5\"}>{t`File details`}</Typography>\n                    </div>\n                    <div\n                        className={classNames(style.preview, {\n                            dark: darkImageBackground\n                        })}\n                    >\n                        {filePlugin.render({ file, uploadFile, validateFiles })}\n                    </div>\n                    <div className={style.download}>\n                        <>\n                            <Tooltip content={<span>{t`Copy URL`}</span>} placement={\"bottom\"}>\n                                <IconButton\n                                    onClick={() => {\n                                        navigator.clipboard.writeText(file.src);\n                                        showSnackbar(t`URL copied successfully.`);\n                                    }}\n                                    icon={<CopyContentIcon style={{ margin: \"0 8px 0 0\" }} />}\n                                />\n                            </Tooltip>\n\n                            {actions.map((Component, index) => (\n                                <Component key={index} {...props} />\n                            ))}\n                            {renderDeleteImageAction(file)}\n                            {/* Render background switcher */}\n                            <Tooltip content={t`Toggle background`} placement={\"bottom\"}>\n                                <IconButton\n                                    icon={<HighlightIcon />}\n                                    onClick={() => setDarkImageBackground(!darkImageBackground)}\n                                    className={classNames({ \"icon--active\": darkImageBackground })}\n                                />\n                            </Tooltip>\n                        </>\n                    </div>\n                    <DrawerContent dir=\"ltr\" className={style.drawerContent}>\n                        <ul className={style.list}>\n                            <li>\n                                <Name {...props} />\n                            </li>\n                            <li>\n                                <li-title>\n                                    <Icon className={\"list-item__icon\"} icon={fileTypeIcon} />\n                                    <div>\n                                        <Typography use={\"subtitle1\"}>{file.type}</Typography>{\" \"}\n                                        {\" - \"}\n                                        <Typography use={\"subtitle1\"}>\n                                            {bytes.format(file.size, { unitSeparator: \" \" })}\n                                        </Typography>\n                                    </div>\n                                </li-title>\n                            </li>\n                            <li>\n                                <li-title>\n                                    <Icon className={\"list-item__icon\"} icon={<CalendarIcon />} />\n                                    <div>\n                                        <Typography use={\"subtitle1\"}>\n                                            {dayjs(file.createdOn).format(\"DD MMM YYYY [at] HH:mm\")}\n                                        </Typography>\n                                    </div>\n                                </li-title>\n                            </li>\n                            <li>\n                                <Tags key={props.file.id} {...props} />\n                            </li>\n                        </ul>\n                    </DrawerContent>\n                </div>\n            )}\n        </Drawer>\n    );\n}\n"],"file":"FileDetails.js"}