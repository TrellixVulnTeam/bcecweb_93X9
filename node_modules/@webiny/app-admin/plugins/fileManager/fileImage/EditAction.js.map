{"version":3,"sources":["../../../../src/plugins/fileManager/fileImage/EditAction.tsx"],"names":["React","Hotkeys","dataURLtoBlob","ImageEditorDialog","Tooltip","IconButton","outputFileSelectionError","useSnackbar","toDataUrl","url","Promise","resolve","xhr","window","XMLHttpRequest","onload","reader","FileReader","onloadend","result","readAsDataURL","response","open","responseType","send","initialState","showImageEditor","dataUrl","reducer","state","action","next","type","EditAction","props","file","uploadFile","validateFiles","canEdit","useReducer","dispatch","showSnackbar","margin","src","blob","errors","length","name"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { Hotkeys } from \"react-hotkeyz\";\nimport dataURLtoBlob from \"dataurl-to-blob\";\nimport { ImageEditorDialog } from \"@webiny/ui/ImageUpload\";\nimport { Tooltip } from \"@webiny/ui/Tooltip\";\nimport { IconButton } from \"@webiny/ui/Button\";\nimport outputFileSelectionError from \"../../../components/FileManager/outputFileSelectionError\";\nimport { useSnackbar } from \"../../../hooks/useSnackbar\";\nimport { ReactComponent as EditIcon } from \"../icons/edit.svg\";\n\nfunction toDataUrl(url) {\n    return new Promise(resolve => {\n        const xhr = new window.XMLHttpRequest();\n        xhr.onload = function () {\n            const reader = new window.FileReader();\n            reader.onloadend = function () {\n                resolve(reader.result);\n            };\n            reader.readAsDataURL(xhr.response);\n        };\n        xhr.open(\"GET\", url);\n        xhr.responseType = \"blob\";\n        xhr.send();\n    });\n}\n\nconst initialState = { showImageEditor: false, dataUrl: null };\nconst reducer = (state, action) => {\n    const next = { ...state };\n\n    switch (action.type) {\n        case \"setDataUrl\":\n            next.dataUrl = action.dataUrl;\n            next.showImageEditor = true;\n            break;\n        case \"hideImageEditor\":\n            next.dataUrl = null;\n            next.showImageEditor = false;\n            break;\n    }\n\n    return next;\n};\n\n// TODO: @adrian\ntype EditActionProps = {\n    file: any;\n    uploadFile: any;\n    validateFiles: any;\n    canEdit: (file: any) => boolean;\n};\n\nconst EditAction: React.FC<EditActionProps> = props => {\n    const { file, uploadFile, validateFiles, canEdit } = props;\n    const [state, dispatch] = React.useReducer(reducer, initialState);\n    const { showSnackbar } = useSnackbar();\n    // Render nothing if the user don't have required permission for \"edit\".\n    if (!canEdit(file)) {\n        return null;\n    }\n\n    return (\n        <>\n            <Tooltip content={<span>Edit image</span>} placement={\"bottom\"}>\n                <IconButton\n                    data-testid={\"fm-edit-image-button\"}\n                    icon={<EditIcon style={{ margin: \"0 8px 0 0\" }} />}\n                    onClick={async () => {\n                        dispatch({ type: \"setDataUrl\", dataUrl: await toDataUrl(file.src) });\n                    }}\n                />\n            </Tooltip>\n            <Hotkeys zIndex={60} disabled={!state.dataUrl}>\n                <ImageEditorDialog\n                    data-testid={\"fm-image-editor-dialog\"}\n                    dialogZIndex={100}\n                    open={state.showImageEditor}\n                    src={state.dataUrl}\n                    onClose={() => dispatch({ type: \"hideImageEditor\" })}\n                    onAccept={src => {\n                        const blob = dataURLtoBlob(src);\n                        const errors = validateFiles([blob]);\n\n                        if (errors.length) {\n                            showSnackbar(outputFileSelectionError(errors));\n                        } else {\n                            blob.name = file.name;\n                            uploadFile(blob);\n                        }\n\n                        dispatch({ type: \"hideImageEditor\" });\n                    }}\n                />\n            </Hotkeys>\n        </>\n    );\n};\n\nexport default EditAction;\n"],"file":"EditAction.js"}