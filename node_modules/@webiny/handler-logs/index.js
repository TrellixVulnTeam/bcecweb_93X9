"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _nodeFetch = _interopRequireDefault(require("node-fetch"));

const consoleLog = console.log;
const logs = [];

console.log = (...args) => {
  logs.push({
    args,
    meta: {
      functionName: process.env.AWS_LAMBDA_FUNCTION_NAME
    }
  });
  consoleLog(...args);
};

var _default = () => ({
  type: "handler-result",

  async apply() {
    const url = process.env.WEBINY_LOGS_FORWARD_URL;

    if (logs.length && typeof url === "string" && url.startsWith("http")) {
      await (0, _nodeFetch.default)(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Bypass-Tunnel-Reminder": "1"
        },
        body: JSON.stringify(logs)
      });
    }

    logs.length = 0;
  }

});

exports.default = _default;
//# sourceMappingURL=index.js.map