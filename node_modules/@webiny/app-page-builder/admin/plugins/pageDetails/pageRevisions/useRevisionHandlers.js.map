{"version":3,"sources":["../../../../../src/admin/plugins/pageDetails/pageRevisions/useRevisionHandlers.ts"],"names":["useCallback","useApolloClient","useRouter","CREATE_PAGE","DELETE_PAGE","usePublishRevisionHandler","useSnackbar","GQLCache","useRevisionHandlers","props","showSnackbar","history","client","page","revision","publishRevision","unpublishRevision","createRevision","mutate","mutation","variables","from","id","update","cache","data","pageBuilder","createPage","error","updateLatestRevisionInListCache","res","message","push","encodeURIComponent","editRevision","deleteRevision","response","deletePage","revisions","removeRevisionFromEntryCache"],"mappings":"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","sourcesContent":["import { useCallback } from \"react\";\nimport { useApolloClient } from \"@apollo/react-hooks\";\nimport { useRouter } from \"@webiny/react-router\";\nimport { CREATE_PAGE, DELETE_PAGE } from \"~/admin/graphql/pages\";\nimport { usePublishRevisionHandler } from \"./usePublishRevisionHandler\";\nimport { useSnackbar } from \"@webiny/app-admin/hooks/useSnackbar\";\nimport * as GQLCache from \"~/admin/views/Pages/cache\";\n\nexport function useRevisionHandlers(props) {\n    const { showSnackbar } = useSnackbar();\n    const { history } = useRouter();\n    const client = useApolloClient();\n    const { page, revision } = props;\n    const { publishRevision, unpublishRevision } = usePublishRevisionHandler({ page });\n\n    const createRevision = useCallback(async () => {\n        const { data: res } = await client.mutate({\n            mutation: CREATE_PAGE,\n            variables: { from: revision.id },\n            update(cache, { data }) {\n                if (data.pageBuilder.createPage.error) {\n                    return;\n                }\n\n                GQLCache.updateLatestRevisionInListCache(cache, data.pageBuilder.createPage.data);\n            }\n        });\n        const { data, error } = res.pageBuilder.createPage;\n\n        if (error) {\n            return showSnackbar(error.message);\n        }\n\n        history.push(`/page-builder/editor/${encodeURIComponent(data.id)}`);\n    }, [revision]);\n\n    const editRevision = useCallback(() => {\n        history.push(`/page-builder/editor/${encodeURIComponent(revision.id)}`);\n    }, [revision]);\n\n    const deleteRevision = useCallback(async () => {\n        const { data: res } = await client.mutate({\n            mutation: DELETE_PAGE,\n            variables: { id: revision.id },\n            update(cache, response) {\n                if (response.data.pageBuilder.deletePage.error) {\n                    return;\n                }\n\n                // We have other revisions, update entry's cache\n                const revisions = GQLCache.removeRevisionFromEntryCache(cache, revision);\n\n                if (revision.id === page.id) {\n                    GQLCache.updateLatestRevisionInListCache(cache, revisions[0]);\n                    // Redirect to the first revision in the list of all entry revisions.\n                    return history.push(\n                        `/page-builder/pages?id=` + encodeURIComponent(revisions[0].id)\n                    );\n                }\n            }\n        });\n        const { error } = res.pageBuilder.deletePage;\n        if (error) {\n            return showSnackbar(error.message);\n        }\n    }, [revision, page]);\n\n    return {\n        publishRevision,\n        unpublishRevision,\n        createRevision,\n        editRevision,\n        deleteRevision\n    };\n}\n"],"file":"useRevisionHandlers.js"}