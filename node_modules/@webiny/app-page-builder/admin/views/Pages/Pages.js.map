{"version":3,"sources":["../../../../src/admin/views/Pages/Pages.tsx"],"names":["React","useMemo","useState","useCallback","SplitView","LeftPanel","RightPanel","PagesDataList","PageDetails","useSecurity","CategoriesDialog","CircularProgress","useRouter","useSnackbar","useMutation","CREATE_PAGE","GQLCache","Pages","creatingPage","setCreatingPage","showCategoriesDialog","setCategoriesDialog","showSnackbar","history","openDialog","closeDialog","create","createPageMutation","category","slug","variables","update","cache","data","pageBuilder","createPage","error","addPageToListCache","res","message","push","encodeURIComponent","id","identity","canCreate","permission","getPermission","rwd","includes"],"mappings":"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","sourcesContent":["import React, { useMemo, useState, useCallback } from \"react\";\nimport { SplitView, LeftPanel, RightPanel } from \"@webiny/app-admin/components/SplitView\";\nimport PagesDataList from \"./PagesDataList\";\nimport PageDetails from \"./PageDetails\";\nimport { useSecurity } from \"@webiny/app-security\";\nimport CategoriesDialog from \"../Categories/CategoriesDialog\";\nimport { CircularProgress } from \"@webiny/ui/Progress\";\nimport { useRouter } from \"@webiny/react-router\";\nimport { useSnackbar } from \"@webiny/app-admin/hooks/useSnackbar\";\nimport { useMutation } from \"@apollo/react-hooks\";\nimport { CREATE_PAGE } from \"../../graphql/pages\";\nimport * as GQLCache from \"~/admin/views/Pages/cache\";\n\nconst Pages = () => {\n    const [creatingPage, setCreatingPage] = useState(false);\n    const [showCategoriesDialog, setCategoriesDialog] = useState(false);\n    const { showSnackbar } = useSnackbar();\n    const { history } = useRouter();\n\n    const openDialog = useCallback(() => setCategoriesDialog(true), []);\n    const closeDialog = useCallback(() => setCategoriesDialog(false), []);\n\n    const [create] = useMutation(CREATE_PAGE);\n\n    const createPageMutation = useCallback(async ({ slug: category }) => {\n        try {\n            setCreatingPage(true);\n            const res = await create({\n                variables: { category },\n                update(cache, { data }) {\n                    if (data.pageBuilder.createPage.error) {\n                        return;\n                    }\n\n                    GQLCache.addPageToListCache(cache, data.pageBuilder.createPage.data);\n                }\n            });\n\n            setCreatingPage(false);\n            closeDialog();\n\n            const { error, data } = res.data.pageBuilder.createPage;\n            if (error) {\n                showSnackbar(error.message);\n            } else {\n                history.push(`/page-builder/editor/${encodeURIComponent(data.id)}`);\n            }\n        } catch (e) {\n            showSnackbar(e.message);\n        }\n    }, []);\n\n    const { identity } = useSecurity();\n\n    const canCreate = useMemo(() => {\n        const permission = identity.getPermission(\"pb.page\");\n        if (!permission) {\n            return false;\n        }\n\n        if (typeof permission.rwd !== \"string\") {\n            return true;\n        }\n\n        return permission.rwd.includes(\"w\");\n    }, []);\n\n    return (\n        <>\n            <CategoriesDialog\n                open={showCategoriesDialog}\n                onClose={closeDialog}\n                onSelect={createPageMutation}\n            >\n                {creatingPage && <CircularProgress label={\"Creating page...\"} />}\n            </CategoriesDialog>\n            <SplitView>\n                <LeftPanel>\n                    <PagesDataList canCreate={canCreate} onCreatePage={openDialog} />\n                </LeftPanel>\n                <RightPanel>\n                    <PageDetails canCreate={canCreate} onCreatePage={openDialog} />\n                </RightPanel>\n            </SplitView>\n        </>\n    );\n};\n\nexport default Pages;\n"],"file":"Pages.js"}