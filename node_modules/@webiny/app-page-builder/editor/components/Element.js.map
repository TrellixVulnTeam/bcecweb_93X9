{"version":3,"sources":["../../../src/editor/components/Element.tsx"],"names":["React","useCallback","useRecoilState","useRecoilValue","useSetRecoilState","Transition","plugins","renderPlugins","Draggable","tryRenderingPlugin","disableDraggingMutation","elementByIdSelector","enableDraggingMutation","uiAtom","activeElementAtom","defaultStyle","ElementContainer","transitionStyles","typeStyle","getElementPlugin","element","pluginsByType","byType","find","pl","elementType","type","ElementComponent","elementId","id","className","isActive","setElementAtomValue","setUiAtomValue","setActiveElementAtomValue","isHighlighted","plugin","beginDrag","data","setTimeout","target","endDrag","onClick","onMouseOver","ev","stopPropagation","onMouseOut","renderDraggable","drag","renderedPlugin","render","isDraggable","Array","isArray","length","state","filter","c","join","withHighlightElement","Component","withHighlightElementComponent","props","activeElementAtomValue","memo"],"mappings":"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","sourcesContent":["import React, { useCallback } from \"react\";\nimport { useRecoilState, useRecoilValue, useSetRecoilState } from \"recoil\";\nimport { Transition } from \"react-transition-group\";\nimport { plugins } from \"@webiny/plugins\";\nimport { renderPlugins } from \"@webiny/app/plugins\";\nimport { PbEditorPageElementPlugin, PbEditorElement } from \"../../types\";\nimport Draggable from \"./Draggable\";\nimport tryRenderingPlugin from \"../../utils/tryRenderingPlugin\";\nimport {\n    disableDraggingMutation,\n    elementByIdSelector,\n    enableDraggingMutation,\n    uiAtom,\n    activeElementAtom\n} from \"../recoil/modules\";\nimport {\n    defaultStyle,\n    ElementContainer,\n    transitionStyles,\n    typeStyle\n} from \"./Element/ElementStyled\";\n\nexport type ElementPropsType = {\n    id: string;\n    className?: string;\n    isHighlighted: boolean;\n    isActive: boolean;\n};\n\nconst getElementPlugin = (element: PbEditorElement): PbEditorPageElementPlugin => {\n    if (!element) {\n        return null;\n    }\n\n    const pluginsByType = plugins.byType<PbEditorPageElementPlugin>(\"pb-editor-page-element\");\n    return pluginsByType.find(pl => pl.elementType === element.type);\n};\n\nconst ElementComponent: React.FunctionComponent<ElementPropsType> = ({\n    id: elementId,\n    className = \"\",\n    isActive\n}) => {\n    const [element, setElementAtomValue] = useRecoilState(elementByIdSelector(elementId));\n    const setUiAtomValue = useSetRecoilState(uiAtom);\n    const setActiveElementAtomValue = useSetRecoilState(activeElementAtom);\n    const { isHighlighted } = element;\n\n    const plugin = getElementPlugin(element);\n\n    const beginDrag = useCallback(() => {\n        const data = { id: element.id, type: element.type };\n        setTimeout(() => {\n            setUiAtomValue(enableDraggingMutation);\n        });\n        return { ...data, target: plugin.target };\n    }, [elementId]);\n\n    const endDrag = useCallback(() => {\n        setUiAtomValue(disableDraggingMutation);\n    }, [elementId]);\n\n    const onClick = useCallback((): void => {\n        if (!element || element.type === \"document\" || isActive) {\n            return;\n        }\n        setActiveElementAtomValue(elementId);\n    }, [elementId, isActive]);\n\n    const onMouseOver = useCallback(\n        (ev): void => {\n            if (!element || element.type === \"document\") {\n                return;\n            }\n            ev.stopPropagation();\n            if (isHighlighted) {\n                return;\n            }\n            setElementAtomValue({ isHighlighted: true } as any);\n        },\n        [elementId]\n    );\n    const onMouseOut = useCallback(() => {\n        if (!element || element.type === \"document\") {\n            return;\n        }\n        setElementAtomValue({ isHighlighted: false } as any);\n    }, [elementId]);\n\n    const renderDraggable = ({ drag }): JSX.Element => {\n        return (\n            <div ref={drag} className={\"type \" + typeStyle}>\n                <div className=\"background\" onClick={onClick} />\n                <div className={\"element-holder\"} onClick={onClick}>\n                    {renderPlugins(\"pb-editor-page-element-action\", { element, plugin })}\n                    <span>{plugin.elementType}</span>\n                </div>\n            </div>\n        );\n    };\n\n    if (!plugin) {\n        return null;\n    }\n\n    const renderedPlugin = tryRenderingPlugin(() =>\n        plugin.render({\n            element,\n            isActive\n        })\n    );\n\n    const isDraggable = Array.isArray(plugin.target) && plugin.target.length > 0;\n\n    return (\n        <Transition in={true} timeout={250} appear={true}>\n            {state => (\n                <ElementContainer\n                    id={element.id}\n                    onMouseOver={onMouseOver}\n                    onMouseOut={onMouseOut}\n                    highlight={isActive ? true : isHighlighted}\n                    active={isActive}\n                    style={{ ...defaultStyle, ...transitionStyles[state] }}\n                    className={\"webiny-pb-page-element-container\"}\n                >\n                    <div className={[\"innerWrapper\", className].filter(c => c).join(\" \")}>\n                        <Draggable\n                            enabled={isDraggable}\n                            target={plugin.target}\n                            beginDrag={beginDrag}\n                            endDrag={endDrag}\n                        >\n                            {renderDraggable}\n                        </Draggable>\n\n                        {renderedPlugin}\n                    </div>\n                </ElementContainer>\n            )}\n        </Transition>\n    );\n};\n\nconst withHighlightElement = (Component: React.FunctionComponent) => {\n    return function withHighlightElementComponent(props) {\n        const activeElementAtomValue = useRecoilValue(activeElementAtom);\n\n        return <Component {...props} isActive={activeElementAtomValue === props.id} />;\n    };\n};\n\nexport default withHighlightElement(React.memo<any>(ElementComponent));\n"],"file":"Element.js"}