{"version":3,"sources":["../../../../src/editor/ui/views/PageSettingsView.tsx"],"names":["plugins","SplitView","ViewElement","OverlayView","usePageSettings","PageSettingsTabElement","PageSettingsTabsElement","PbEditorPageSettingsPlugin","GenericElement","FormElement","FormView","PageSettingsView","Map","addHookDefinition","addOnExited","getPageSettingsHook","closeSettings","setTitle","setupView","applyPlugins","setupLegacyPlugins","isRendered","then","setIsVisible","_splitView","getLeftPanel","getRightPanel","section","_sections","set","id","_tabs","addElement","_form","view","shouldRender","activeSection","values","next","value","get","getHook","onSubmit","data","savePage","getData","pageData","getContentElement","oldPlugins","byType","type","forEach","pl","formView","name","title","setFormData","setOnSubmit","getFormContentElement","props","render","formProps","addSection","description","icon"],"mappings":"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","sourcesContent":["import { plugins } from \"@webiny/plugins\";\nimport { SplitView } from \"@webiny/app-admin/ui/views/SplitView\";\nimport { ViewElement } from \"@webiny/app-admin/ui/elements/ViewElement\";\nimport { OverlayView } from \"@webiny/app-admin/ui/views/OverlayView\";\nimport { UsePageSettings, usePageSettings } from \"~/editor/hooks/usePageSettings\";\nimport {\n    PageSettingsTabElement,\n    PageSettingsTabElementConfig\n} from \"~/editor/ui/views/PageSettingsView/PageSettingsTabElement\";\nimport { PageSettingsTabsElement } from \"~/editor/ui/views/PageSettingsView/PageSettingsTabsElement\";\nimport { PbEditorPageSettingsPlugin } from \"~/plugins/PbEditorPageSettingsPlugin\";\nimport { GenericElement } from \"@webiny/app-admin/ui/elements/GenericElement\";\nimport {\n    FormElement,\n    FormElementRenderProps\n} from \"@webiny/app-admin/ui/elements/form/FormElement\";\nimport { FormView } from \"@webiny/app-admin/ui/views/FormView\";\n\nexport class PageSettingsView extends OverlayView {\n    private _splitView: SplitView;\n    private _sections = new Map<string, PageSettingsTabElementConfig>();\n    private _tabs: PageSettingsTabsElement;\n    private _form: FormElement;\n\n    constructor() {\n        super(\"PageSettingsView\");\n\n        this.addHookDefinition(\"pageSettings\", usePageSettings);\n\n        this.addOnExited(() => {\n            this.getPageSettingsHook().closeSettings();\n        });\n\n        this.setTitle(() => \"Page Settings\");\n\n        this.setupView();\n        this.applyPlugins(PageSettingsView);\n\n        this.setupLegacyPlugins();\n\n        // Show this view as soon as it's mounted.\n        this.isRendered().then(() => this.setIsVisible(true));\n    }\n\n    getLeftPanel() {\n        return this._splitView.getLeftPanel();\n    }\n\n    getRightPanel() {\n        return this._splitView.getRightPanel();\n    }\n\n    addSection(section: PageSettingsTabElementConfig) {\n        this._sections.set(section.id, section);\n\n        this._tabs.addElement(new PageSettingsTabElement(section.id, section));\n        this._form.addElement(\n            new ViewElement(section.id, {\n                view: section.view,\n                shouldRender: () => {\n                    const { activeSection } = this.getPageSettingsHook();\n                    if (!activeSection && section.id === \"general\") {\n                        return true;\n                    }\n\n                    return this.getPageSettingsHook().activeSection === section.id;\n                }\n            })\n        );\n    }\n\n    getActiveSection(): PageSettingsTabElementConfig {\n        const { activeSection } = this.getPageSettingsHook();\n        if (!activeSection) {\n            return this._sections.values().next().value;\n        }\n        return this._sections.get(activeSection);\n    }\n\n    getPageSettingsHook() {\n        return this.getHook<UsePageSettings>(\"pageSettings\");\n    }\n\n    private setupView() {\n        this._splitView = new SplitView(\"pageSettingsContent\");\n\n        this._form = new FormElement(\"form\", {\n            onSubmit: data => this.getPageSettingsHook().savePage(data),\n            getData: () => this.getPageSettingsHook().pageData\n        });\n\n        this.getContentElement().addElement(\n            new ViewElement(\"pageSettingsContent\", { view: this._splitView })\n        );\n        this._tabs = this._splitView.getLeftPanel().addElement(new PageSettingsTabsElement(\"tabs\"));\n        this.getRightPanel().addElement(this._form);\n    }\n\n    private setupLegacyPlugins() {\n        // IMPORTANT! The following piece of code is for BACKWARDS COMPATIBILITY purposes only!\n        const oldPlugins = plugins.byType<PbEditorPageSettingsPlugin>(\n            PbEditorPageSettingsPlugin.type\n        );\n\n        oldPlugins.forEach(pl => {\n            const formView = new FormView(pl.name);\n            formView.setTitle(() => pl.title);\n            formView.setFormData(() => this.getPageSettingsHook().pageData);\n            formView.setOnSubmit(data => this.getPageSettingsHook().savePage(data));\n            formView.getFormContentElement().addElement(\n                new GenericElement<FormElementRenderProps>(\"fields\", props => {\n                    return pl.render(props.formProps);\n                })\n            );\n\n            this.addSection({\n                id: pl.name,\n                title: pl.title,\n                description: pl.description,\n                icon: pl.icon,\n                view: formView\n            });\n        });\n    }\n}\n"],"file":"PageSettingsView.js"}