{"version":3,"sources":["../../../../src/editor/plugins/pageSettings/index.tsx"],"names":["React","gql","get","AddQuerySelectionPlugin","GeneralSettingsView","UIViewPlugin","PageSettingsView","SocialSettingsView","appendOgImageDimensions","HiddenElement","SEOSettingsView","plugins","view","addSection","id","title","description","icon","image","getElement","ogImageTags","name","moveToTheEndOf","getFormContentElement","addAfterChange","value","form","src","data","hasOgImage","startsWith","setValue","operationName","selectionPath","addSelection"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { gql } from \"graphql-tag\";\nimport get from \"lodash/get\";\nimport { PluginCollection } from \"@webiny/plugins/types\";\nimport { AddQuerySelectionPlugin } from \"@webiny/app/plugins/AddQuerySelectionPlugin\";\nimport { ReactComponent as SettingsIcon } from \"./icons/round-settings-24px.svg\";\nimport { ReactComponent as SocialIcon } from \"./icons/round-thumb_up-24px.svg\";\nimport { ReactComponent as SeoIcon } from \"./icons/round-search-24px.svg\";\nimport { GeneralSettingsView } from \"~/editor/ui/views/GeneralSettingsView\";\nimport { UIViewPlugin } from \"@webiny/app-admin/ui/UIView\";\nimport { PageSettingsView } from \"~/editor/ui/views/PageSettingsView\";\nimport { SocialSettingsView } from \"~/editor/ui/views/SocialSettingsView\";\nimport { FileManagerElement } from \"@webiny/app-admin/ui/elements/form/FileManagerElement\";\nimport appendOgImageDimensions from \"./appendOgImageDimensions\";\nimport { HiddenElement } from \"@webiny/app-admin/ui/elements/form/HiddenElement\";\nimport { SEOSettingsView } from \"~/editor/ui/views/SEOSettingsView\";\n\nconst plugins: PluginCollection = [\n    new UIViewPlugin<PageSettingsView>(PageSettingsView, view => {\n        view.addSection({\n            id: \"general\",\n            title: \"General settings\",\n            description: \"Manage things like title, page status, path, and more.\",\n            icon: <SettingsIcon />,\n            view: new GeneralSettingsView()\n        });\n\n        view.addSection({\n            id: \"social\",\n            title: \"Social media\",\n            description: \"Set share images and settings for social media websites.\",\n            icon: <SocialIcon />,\n            view: new SocialSettingsView()\n        });\n\n        view.addSection({\n            id: \"seo\",\n            title: \"SEO\",\n            description: \"Control SEO settings like description and keywords.\",\n            icon: <SeoIcon />,\n            view: new SEOSettingsView()\n        });\n    }),\n    /**\n     * When image is changed in General settings, generate OG image tags in Social Media settings.\n     */\n    new UIViewPlugin<GeneralSettingsView>(GeneralSettingsView, view => {\n        const image = view.getElement<FileManagerElement>(\"image\");\n        if (!image) {\n            return;\n        }\n\n        const ogImageTags = new HiddenElement(\"socialMeta\", { name: \"settings.social.meta\" });\n        ogImageTags.moveToTheEndOf(view.getFormContentElement());\n\n        image.addAfterChange((value, form) => {\n            const src = get(form.data, \"settings.social.image.src\");\n\n            const hasOgImage = typeof src === \"string\" && src && !src.startsWith(\"data:\");\n\n            // If not already set, set selectedImage as og:image too.\n            if (value && !hasOgImage) {\n                appendOgImageDimensions({\n                    data: form.data,\n                    value,\n                    setValue: form.setValue\n                });\n            }\n        });\n    }),\n    new AddQuerySelectionPlugin({\n        operationName: \"PbGetPage\",\n        selectionPath: \"pageBuilder.getPage.data\",\n        addSelection: gql`\n            {\n                settings {\n                    general {\n                        snippet\n                        image {\n                            id\n                            src\n                        }\n                        tags\n                        layout\n                    }\n                }\n            }\n        `\n    }),\n    new AddQuerySelectionPlugin({\n        operationName: \"PbGetPage\",\n        selectionPath: \"pageBuilder.getPage.data\",\n        addSelection: gql`\n            {\n                settings {\n                    seo {\n                        title\n                        description\n                        meta {\n                            name\n                            content\n                        }\n                    }\n                }\n            }\n        `\n    }),\n    new AddQuerySelectionPlugin({\n        operationName: \"PbGetPage\",\n        selectionPath: \"pageBuilder.getPage.data\",\n        addSelection: gql`\n            {\n                settings {\n                    social {\n                        image {\n                            id\n                            src\n                        }\n                        title\n                        description\n                        meta {\n                            property\n                            content\n                        }\n                    }\n                }\n            }\n        `\n    })\n];\n\nexport default plugins;\n"],"file":"index.js"}