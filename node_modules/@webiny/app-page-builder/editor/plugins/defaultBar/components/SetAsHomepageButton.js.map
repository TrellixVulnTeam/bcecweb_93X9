{"version":3,"sources":["../../../../../src/editor/plugins/defaultBar/components/SetAsHomepageButton.tsx"],"names":["React","gql","pageAtom","useSnackbar","useRouter","MenuItem","ListItemGraphic","Icon","useMutation","ConfirmationDialog","useRecoilValue","usePageBuilderSettings","PUBLISH_PAGE","SetAsHomepageButton","page","history","showSnackbar","publishPageMutation","settings","updateSettingsMutation","isSpecialPage","showConfirmation","publish","variables","id","updateSettings","data","pages","home","response","error","pageBuilder","message","push","setTimeout","memo"],"mappings":";;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,GAAP,MAAgB,aAAhB;AACA,SAASC,QAAT;AACA,SAASC,WAAT,QAA4B,qCAA5B;AACA,SAASC,SAAT,QAA0B,sBAA1B;AACA,SAASC,QAAT,QAAyB,iBAAzB;AACA,SAASC,eAAT,QAAgC,iBAAhC;AACA,SAASC,IAAT,QAAqB,iBAArB;;AAEA,SAASC,WAAT,QAA4B,qBAA5B;AACA,SAASC,kBAAT,QAAmC,+BAAnC;AACA,SAASC,cAAT,QAA+B,QAA/B;AACA,SAASC,sBAAT;AAEA,IAAMC,YAAY,GAAGX,GAAH,mcAAlB;;AAmBA,IAAMY,mBAA4C,GAAG,SAA/CA,mBAA+C,GAAM;AACvD,MAAMC,IAAI,GAAGJ,cAAc,CAACR,QAAD,CAA3B;;AACA,mBAAoBE,SAAS,EAA7B;AAAA,MAAQW,OAAR,cAAQA,OAAR;;AACA,qBAAyBZ,WAAW,EAApC;AAAA,MAAQa,YAAR,gBAAQA,YAAR;;AACA,MAAMC,mBAAmB,GAAGT,WAAW,CAACI,YAAD,CAAvC;;AAEA,8BAA4DD,sBAAsB,EAAlF;AAAA,MAAQO,QAAR,yBAAQA,QAAR;AAAA,MAAkBC,sBAAlB,yBAAkBA,sBAAlB;AAAA,MAA0CC,aAA1C,yBAA0CA,aAA1C;;AAEA,sBACI,oBAAC,kBAAD;AACI,IAAA,OAAO,eACH;AAFR,KAQK;AAAA,QAAGC,gBAAH,QAAGA,gBAAH;AAAA,wBACG,oBAAC,QAAD;AACI,MAAA,QAAQ,EAAED,aAAa,CAACN,IAAD,EAAO,MAAP,CAD3B;AAEI,MAAA,OAAO,EAAE,mBAAM;AACXO,QAAAA,gBAAgB,wEAAC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,wDACKJ,mBADL,MACNK,OADM;AAAA;AAAA,yBAEPA,OAAO,CAAC;AACVC,oBAAAA,SAAS,EAAE;AAAEC,sBAAAA,EAAE,EAAEV,IAAI,CAACU;AAAX;AADD,mBAAD,CAFA;;AAAA;AAAA,yDAMYL,sBANZ,MAMNM,cANM;AAAA;AAAA,yBAOUA,cAAc,CAAC;AAClCF,oBAAAA,SAAS,EAAE;AACPG,sBAAAA,IAAI,EAAE;AACFC,wBAAAA,KAAK,kCACET,QAAQ,CAACS,KADX;AAEDC,0BAAAA,IAAI,EAAEd,IAAI,CAACU;AAFV;AADH;AADC;AADuB,mBAAD,CAPxB;;AAAA;AAOPK,kBAAAA,QAPO;AAkBLC,kBAAAA,KAlBK,GAkBKD,QAAQ,CAACH,IAAT,CAAcK,WAAd,CAA0BN,cAlB/B,CAkBLK,KAlBK;;AAAA,uBAmBTA,KAnBS;AAAA;AAAA;AAAA;;AAAA,mDAoBFd,YAAY,CAACc,KAAK,CAACE,OAAP,CApBV;;AAAA;AAuBbjB,kBAAAA,OAAO,CAACkB,IAAR,kCAAuCnB,IAAI,CAACU,EAA5C,GAvBa,CAyBb;;AACAU,kBAAAA,UAAU,CAAC;AAAA,2BAAMlB,YAAY,CAAC,gCAAD,CAAlB;AAAA,mBAAD,EAAuD,GAAvD,CAAV;;AA1Ba;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAD,GAAhB;AA4BH;AA/BL,oBAiCI,oBAAC,eAAD,qBACI,oBAAC,IAAD;AAAM,MAAA,IAAI,eAAE,oBAAC,QAAD;AAAZ,MADJ,CAjCJ,oBADH;AAAA,GARL,CADJ;AAmDH,CA3DD;;AA6DA,4BAAehB,KAAK,CAACmC,IAAN,CAAWtB,mBAAX,CAAf","sourcesContent":["import React from \"react\";\nimport gql from \"graphql-tag\";\nimport { pageAtom } from \"../../../recoil/modules\";\nimport { useSnackbar } from \"@webiny/app-admin/hooks/useSnackbar\";\nimport { useRouter } from \"@webiny/react-router\";\nimport { MenuItem } from \"@webiny/ui/Menu\";\nimport { ListItemGraphic } from \"@webiny/ui/List\";\nimport { Icon } from \"@webiny/ui/Icon\";\nimport { ReactComponent as HomeIcon } from \"../../../../admin/assets/round-home-24px.svg\";\nimport { useMutation } from \"@apollo/react-hooks\";\nimport { ConfirmationDialog } from \"@webiny/ui/ConfirmationDialog\";\nimport { useRecoilValue } from \"recoil\";\nimport { usePageBuilderSettings } from \"../../../../admin/hooks/usePageBuilderSettings\";\n\nconst PUBLISH_PAGE = gql`\n    mutation PbPublishPage($id: ID!) {\n        pageBuilder {\n            publishPage(id: $id) {\n                data {\n                    id\n                    path\n                    status\n                    locked\n                }\n                error {\n                    code\n                    message\n                }\n            }\n        }\n    }\n`;\n\nconst SetAsHomepageButton: React.FunctionComponent = () => {\n    const page = useRecoilValue(pageAtom);\n    const { history } = useRouter();\n    const { showSnackbar } = useSnackbar();\n    const publishPageMutation = useMutation(PUBLISH_PAGE);\n\n    const { settings, updateSettingsMutation, isSpecialPage } = usePageBuilderSettings();\n\n    return (\n        <ConfirmationDialog\n            message={\n                <span>\n                    You&#39;re about to set this page as your new homepage, are you sure you want to\n                    continue? Note that the page will automatically be published.\n                </span>\n            }\n        >\n            {({ showConfirmation }) => (\n                <MenuItem\n                    disabled={isSpecialPage(page, \"home\")}\n                    onClick={() => {\n                        showConfirmation(async () => {\n                            const [publish] = publishPageMutation;\n                            await publish({\n                                variables: { id: page.id }\n                            });\n\n                            const [updateSettings] = updateSettingsMutation;\n                            const response = await updateSettings({\n                                variables: {\n                                    data: {\n                                        pages: {\n                                            ...settings.pages,\n                                            home: page.id\n                                        }\n                                    }\n                                }\n                            });\n\n                            const { error } = response.data.pageBuilder.updateSettings;\n                            if (error) {\n                                return showSnackbar(error.message);\n                            }\n\n                            history.push(`/page-builder/pages?id=${page.id}`);\n\n                            // Let's wait a bit, because we are also redirecting the user.\n                            setTimeout(() => showSnackbar(\"New homepage set successfully!\"), 500);\n                        });\n                    }}\n                >\n                    <ListItemGraphic>\n                        <Icon icon={<HomeIcon />} />\n                    </ListItemGraphic>\n                    Set as homepage\n                </MenuItem>\n            )}\n        </ConfirmationDialog>\n    );\n};\n\nexport default React.memo(SetAsHomepageButton);\n"],"file":"SetAsHomepageButton.js"}