{"version":3,"sources":["../../../../../../src/editor/plugins/elementSettings/save/SaveDialog/ElementPreview.tsx"],"names":["useEffect","renderToStaticMarkup","plugins","domToImage","replaceContent","element","doc","pl","byType","find","elementType","type","renderElementPreview","elementNode","document","getElementById","id","newContentString","width","offsetWidth","height","offsetHeight","wrapper","createElement","innerHTML","newContentDoc","firstChild","validId","Number","isNaN","parseInt","docElement","querySelector","replaceWith","console","warn","elements","length","forEach","el","generateImage","onChange","node","editor","classList","add","toPng","onDocument","dataUrl","remove","ElementPreview"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\nimport { renderToStaticMarkup } from \"react-dom/server\";\nimport { plugins } from \"@webiny/plugins\";\nimport domToImage from \"./domToImage\";\nimport { PbEditorPageElementPlugin } from \"../../../../../types\";\n\nconst replaceContent = (element: any, doc: Document): Document => {\n    const pl = plugins\n        .byType<PbEditorPageElementPlugin>(\"pb-editor-page-element\")\n        .find(pl => pl.elementType === element.type);\n\n    if (!pl) {\n        return doc;\n    }\n\n    if (typeof pl.renderElementPreview === \"function\") {\n        const elementNode: HTMLElement | null = document.getElementById(element.id);\n\n        if (!elementNode) {\n            return doc;\n        }\n\n        const newContentString = renderToStaticMarkup(\n            pl.renderElementPreview({\n                element,\n                width: elementNode.offsetWidth || 0,\n                height: elementNode.offsetHeight || 0\n            })\n        );\n\n        const wrapper = document.createElement(\"div\");\n        wrapper.innerHTML = newContentString;\n\n        const newContentDoc: ChildNode = wrapper.firstChild;\n        // Element id must not start with a number.\n        const validId = Number.isNaN(parseInt(element.id[0]));\n        if (validId) {\n            const docElement = doc.querySelector(`#${element.id}`);\n            docElement && docElement.replaceWith(newContentDoc);\n        } else {\n            console.warn(`Element \"id\" must not start with a number.`);\n        }\n    }\n\n    if (element.elements.length) {\n        element.elements.forEach(el => {\n            doc = replaceContent(el, doc);\n        });\n    }\n\n    return doc;\n};\n\nconst generateImage = async (element: any, onChange: (value: string) => void): Promise<void> => {\n    const node = document.getElementById(element.id);\n    if (!node) {\n        return;\n    }\n\n    const editor = document.querySelector(\".pb-editor\");\n    // Hide element highlight while creating the image\n    editor.classList.add(\"pb-editor-no-highlight\");\n\n    const dataUrl = await domToImage.toPng(node, {\n        onDocument: doc => replaceContent(element, doc),\n        width: 1000\n    });\n\n    editor.classList.remove(\"pb-editor-no-highlight\");\n\n    onChange(dataUrl);\n};\n\ntype ElementPreviewPropsType = {\n    element: any;\n    onChange: (value: string) => void;\n};\nconst ElementPreview: React.FunctionComponent<ElementPreviewPropsType> = ({\n    element,\n    onChange\n}) => {\n    useEffect(() => {\n        generateImage(element, onChange);\n    });\n\n    return null;\n};\n\nexport default ElementPreview;\n"],"file":"ElementPreview.js"}