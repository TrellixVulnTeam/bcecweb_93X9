{"version":3,"sources":["../../../../../src/editor/recoil/actions/dropElement/action.ts"],"names":["invariant","plugins","elementPluginType","getElementTypePlugin","type","pluginsByType","byType","plugin","find","pl","elementType","Error","getSourceElement","state","source","id","getElementById","dropElementAction","meta","args","target","position","targetElement","onReceived","sourceElement"],"mappings":";;AAAA,OAAOA,SAAP,MAAsB,WAAtB;AAQA,SAASC,OAAT,QAAwB,iBAAxB;AAGA,IAAMC,iBAAiB,GAAG,wBAA1B;;AAEA,IAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACC,IAAD,EAA6C;AACtE,MAAMC,aAAa,GAAGJ,OAAO,CAACK,MAAR,CAA0CJ,iBAA1C,CAAtB;AACA,MAAMK,MAAM,GAAGF,aAAa,CAACG,IAAd,CAAmB,UAAAC,EAAE;AAAA,WAAIA,EAAE,CAACC,WAAH,KAAmBN,IAAvB;AAAA,GAArB,CAAf;;AACA,MAAI,CAACG,MAAL,EAAa;AACT,UAAM,IAAII,KAAJ,mCAAoCT,iBAApC,iCAA2EE,IAA3E,EAAN;AACH;;AACD,SAAOG,MAAP;AACH,CAPD;;AASA,IAAMK,gBAAgB;AAAA,sEAAG,iBACrBC,KADqB,EAErBC,MAFqB;AAAA;AAAA;AAAA;AAAA;AAAA,iBAIjBA,MAAM,CAACC,EAJU;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAKJF,KAAK,CAACG,cAAN,CAAqBF,MAAM,CAACC,EAA5B,CALI;;AAAA;AAAA;;AAAA;AAAA,6CAQdD,MARc;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAhBF,gBAAgB;AAAA;AAAA;AAAA,GAAtB;;AAWA,OAAO,IAAMK,iBAAiE;AAAA,uEAAG,kBAC7EJ,KAD6E,EAE7EK,IAF6E,EAG7EC,IAH6E;AAAA;AAAA;AAAA;AAAA;AAAA;AAKrEL,YAAAA,MALqE,GAKlDK,IALkD,CAKrEL,MALqE,EAK7DM,MAL6D,GAKlDD,IALkD,CAK7DC,MAL6D;AAMrEL,YAAAA,EANqE,GAM9CK,MAN8C,CAMrEL,EANqE,EAMjEX,IANiE,GAM9CgB,MAN8C,CAMjEhB,IANiE,EAM3DiB,QAN2D,GAM9CD,MAN8C,CAM3DC,QAN2D;AAAA;AAAA,mBAOjDR,KAAK,CAACG,cAAN,CAAqBD,EAArB,CAPiD;;AAAA;AAOvEO,YAAAA,aAPuE;;AAAA,gBAQxEA,aARwE;AAAA;AAAA;AAAA;;AAAA,kBASnE,IAAIX,KAAJ,yCAA0CI,EAA1C,QATmE;;AAAA;AAWvER,YAAAA,MAXuE,GAW9DJ,oBAAoB,CAACC,IAAD,CAX0C;AAY7EJ,YAAAA,SAAS,CACLO,MAAM,CAACgB,UADF,EAEL,sEAFK,CAAT;AAZ6E;AAAA,mBAiBjDX,gBAAgB,CAACC,KAAD,EAAQC,MAAR,CAjBiC;;AAAA;AAiBvEU,YAAAA,aAjBuE;AAAA,8CAmBtEjB,MAAM,CAACgB,UAAP,CAAkB;AACrBV,cAAAA,KAAK,EAALA,KADqB;AAErBK,cAAAA,IAAI,EAAJA,IAFqB;AAGrBJ,cAAAA,MAAM,EAAEU,aAHa;AAIrBJ,cAAAA,MAAM,EAAEE,aAJa;AAKrBD,cAAAA,QAAQ,EAAEA;AALW,aAAlB,CAnBsE;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAjEJ,iBAAiE;AAAA;AAAA;AAAA,GAAvE","sourcesContent":["import invariant from \"invariant\";\nimport { DragObjectWithTypeWithTarget } from \"../../../components/Droppable\";\nimport {\n    PbEditorPageElementPlugin,\n    EventActionCallable,\n    EventActionHandlerCallableState,\n    PbEditorElement\n} from \"../../../../types\";\nimport { plugins } from \"@webiny/plugins\";\nimport { DropElementActionArgsType } from \"./types\";\n\nconst elementPluginType = \"pb-editor-page-element\";\n\nconst getElementTypePlugin = (type: string): PbEditorPageElementPlugin => {\n    const pluginsByType = plugins.byType<PbEditorPageElementPlugin>(elementPluginType);\n    const plugin = pluginsByType.find(pl => pl.elementType === type);\n    if (!plugin) {\n        throw new Error(`There is no plugin in \"${elementPluginType}\" for element type ${type}`);\n    }\n    return plugin;\n};\n\nconst getSourceElement = async (\n    state: EventActionHandlerCallableState,\n    source: DragObjectWithTypeWithTarget\n): Promise<PbEditorElement | DragObjectWithTypeWithTarget> => {\n    if (source.id) {\n        return await state.getElementById(source.id);\n    }\n\n    return source;\n};\n\nexport const dropElementAction: EventActionCallable<DropElementActionArgsType> = async (\n    state,\n    meta,\n    args\n) => {\n    const { source, target } = args;\n    const { id, type, position } = target;\n    const targetElement = await state.getElementById(id);\n    if (!targetElement) {\n        throw new Error(`There is no element with id \"${id}\"`);\n    }\n    const plugin = getElementTypePlugin(type);\n    invariant(\n        plugin.onReceived,\n        \"To accept drops, element plugin must implement `onReceived` function\"\n    );\n\n    const sourceElement = await getSourceElement(state, source);\n\n    return plugin.onReceived({\n        state,\n        meta,\n        source: sourceElement,\n        target: targetElement,\n        position: position\n    });\n};\n"],"file":"action.js"}