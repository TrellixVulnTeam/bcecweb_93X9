{"version":3,"sources":["../../src/hooks/usePermission.ts"],"names":["useCallback","useMemo","get","useSecurity","usePermission","identity","pbPagePermission","getPermission","hasFullAccess","canEdit","item","creatorId","own","login","rwd","includes","canDelete","canPublish","pw","canUnpublish","canRequestReview","canRequestChange"],"mappings":"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","sourcesContent":["import { useCallback, useMemo } from \"react\";\nimport get from \"lodash/get\";\nimport { useSecurity } from \"@webiny/app-security\";\n\nconst usePermission = () => {\n    const { identity } = useSecurity();\n\n    const pbPagePermission = useMemo(() => identity.getPermission(\"pb.page\"), []);\n    const hasFullAccess = useMemo(() => identity.getPermission(\"pb.*\"), []);\n\n    const canEdit = useCallback(\n        item => {\n            if (hasFullAccess) {\n                return true;\n            }\n            const creatorId = get(item, \"createdBy.id\");\n            if (!pbPagePermission) {\n                return false;\n            }\n            if (pbPagePermission.own && creatorId) {\n                return creatorId === identity.login;\n            }\n            if (typeof pbPagePermission.rwd === \"string\") {\n                return pbPagePermission.rwd.includes(\"w\");\n            }\n            return true;\n        },\n        [pbPagePermission, hasFullAccess]\n    );\n\n    const canDelete = useCallback(\n        item => {\n            if (hasFullAccess) {\n                return true;\n            }\n            if (!pbPagePermission) {\n                return false;\n            }\n            if (pbPagePermission.own) {\n                return get(item, \"createdBy.id\") === identity.login;\n            }\n            if (typeof pbPagePermission.rwd === \"string\") {\n                return pbPagePermission.rwd.includes(\"d\");\n            }\n            return true;\n        },\n        [pbPagePermission, hasFullAccess]\n    );\n\n    const canPublish = useCallback(() => {\n        if (hasFullAccess) {\n            return true;\n        }\n        if (!pbPagePermission) {\n            return false;\n        }\n        if (typeof pbPagePermission.pw === \"string\") {\n            return pbPagePermission.pw.includes(\"p\");\n        }\n        return false;\n    }, [pbPagePermission, hasFullAccess]);\n\n    const canUnpublish = useCallback(() => {\n        if (hasFullAccess) {\n            return true;\n        }\n        if (!pbPagePermission) {\n            return false;\n        }\n        if (typeof pbPagePermission.pw === \"string\") {\n            return pbPagePermission.pw.includes(\"u\");\n        }\n        return false;\n    }, [pbPagePermission, hasFullAccess]);\n\n    const canRequestReview = useCallback(() => {\n        if (hasFullAccess) {\n            return true;\n        }\n        if (!pbPagePermission) {\n            return false;\n        }\n        if (typeof pbPagePermission.pw === \"string\") {\n            return pbPagePermission.pw.includes(\"r\");\n        }\n        return false;\n    }, [pbPagePermission, hasFullAccess]);\n\n    const canRequestChange = useCallback(() => {\n        if (hasFullAccess) {\n            return true;\n        }\n        if (!pbPagePermission) {\n            return false;\n        }\n        if (typeof pbPagePermission.pw === \"string\") {\n            return pbPagePermission.pw.includes(\"c\");\n        }\n        return false;\n    }, [pbPagePermission, hasFullAccess]);\n\n    return {\n        canEdit,\n        canDelete,\n        canPublish,\n        canUnpublish,\n        canRequestReview,\n        canRequestChange\n    };\n};\n\nexport default usePermission;\n"],"file":"usePermission.js"}